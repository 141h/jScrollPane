/*
 * jScrollPane - v2.0.0beta1 - 2010-08-06
 * http://jscrollpane.kelvinluck.com/
 *
 * Copyright (c) 2010 Kelvin Luck
 * Dual licensed under the MIT and GPL licenses.
 */
(function(b,a,c){b.fn.jScrollPane=function(f){function d(ac,aa){var ah,h=this,Z,H,Q,am,U,ag,Y,D,q,ak,m,V,z,p,aj,C,O,ab,T,o,R,B,W,E,G,N,n,J,y,ai;H={};I(aa);function I(ap){var av,au,at,aq,ar,ao,an;ah=ap;if(Z==c){ac.css("overflow","hidden");Q=ac.innerWidth();am=ac.innerHeight();Z=b('<div class="jspPane" />').wrap(b('<div class="jspContainer" />').css({width:Q+"px",height:am+"px"}));ac.css("overflow","visible");ac.wrap(Z.parent());Z=ac.parent();U=Z.parent();at=ac.find(":first-child");aq=ac.find(":last-child");U.css({"margin-top":at.css("margin-top"),"margin-bottom":aq.css("margin-bottom")});at.css("margin-top",0);aq.css("margin-bottom",0)}else{Q=U.outerWidth();am=U.outerHeight();U.find(".jspVerticalBar,.jspHorizontalBar").remove().end()}ac.css({width:"auto",height:"auto"});av=ac.clone().css("position","absolute");au=b('<div style="width:1px; position: relative;" />').append(av);b("body").append(au);ag=Math.max(ac.outerWidth(),av.outerWidth());au.remove();Y=ac.outerHeight();D=ag/Q;q=Y/am;ak=q>1;m=D>1;if(!(m||ak)){ac.removeClass("jspScrollable");Z.css("top",0);P();r();u()}else{ac.addClass("jspScrollable");ar=ah.maintainPosition&&(p||O);if(ar){ao=j();an=g()}x();ae();k();if(ar){w(ao);v(an)}t();al();if(ah.hijackInternalLinks){i()}}}function x(){if(ak){U.append(b('<div class="jspVerticalBar" />').append(b('<div class="jspCap jspCapTop" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragTop" />'),b('<div class="jspDragBottom" />'))),b('<div class="jspCap jspCapBottom" />')));ab=U.find(">.jspVerticalBar");T=ab.find(">.jspTrack");V=T.find(">.jspDrag");if(ah.showArrows){W=b('<a href="#" class="jspArrow jspArrowUp">Scroll up</a>').bind("mousedown.jsp",F(0,-1)).bind("click.jsp",ad);E=b('<a href="#" class="jspArrow jspArrowDown">Scroll down</a>').bind("mousedown.jsp",F(0,1)).bind("click.jsp",ad);T.before(W).after(E)}R=am;U.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){R-=b(this).outerHeight()});V.hover(function(){V.addClass("jspHover")},function(){V.removeClass("jspHover")}).bind("mousedown.jsp",function(an){b("html").bind("dragstart.jsp selectstart.jsp",function(){return false});var s=an.pageY-V.position().top;b("html").bind("mousemove.jsp",function(ao){K(ao.pageY-s)}).bind("mouseup.jsp mouseleave.jsp",A);return false});M();l()}else{P()}}function M(){T.height(R+"px");p=0;o=ah.verticalGutter+T.outerWidth();Z.width(Q-o);if(ab.position().left==0){Z.css("margin-left",o+"px")}}function ae(){if(m){U.append(b('<div class="jspHorizontalBar" />').append(b('<div class="jspCap jspCapLeft" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragLeft" />'),b('<div class="jspDragRight" />'))),b('<div class="jspCap jspCapRight" />')));G=U.find(">.jspHorizontalBar");N=G.find(">.jspTrack");aj=N.find(">.jspDrag");if(ah.showArrows){y=b('<a href="#" class="jspArrow jspArrowLeft">Scroll left</a>').bind("mousedown.jsp",F(-1,0)).bind("click.jsp",ad);ai=b('<a href="#" class="jspArrow jspArrowRight">Scroll right</a>').bind("mousedown.jsp",F(1,0)).bind("click.jsp",ad);N.before(y).after(ai)}aj.hover(function(){aj.addClass("jspHover")},function(){aj.removeClass("jspHover")}).bind("mousedown.jsp",function(an){b("html").bind("dragstart.jsp selectstart.jsp",function(){return false});var s=an.pageX-aj.position().left;b("html").bind("mousemove.jsp",function(ao){L(ao.pageX-s)}).bind("mouseup.jsp mouseleave.jsp",A);return false});n=U.innerWidth();X()}else{}}function X(){Z.height(am-ah.horizontalGutter-N.outerHeight());U.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){n-=b(this).outerWidth()});N.width(n+"px");O=0}function k(){if(m&&ak){var an=N.outerHeight(),s=T.outerWidth();R-=an;b(G).find(">.jspCap:visible,>.jspArrow").each(function(){n+=b(this).outerWidth()
});n-=s;am-=s;Q-=an;N.parent().append(b('<div class="jspCorner" />').css("width",an+"px"));M();X()}if(m){Z.width(U.outerWidth()+"px")}Y=ac.outerHeight();q=Y/am;if(m){J=1/D*n;if(J>ah.horizontalDragMaxWidth){J=ah.horizontalDragMaxWidth}else{if(J<ah.horizontalDragMinWidth){J=ah.horizontalDragMinWidth}}aj.width(J+"px");C=n-J}if(ak){B=1/q*R;if(B>ah.verticalDragMaxHeight){B=ah.verticalDragMaxHeight}else{if(B<ah.verticalDragMinHeight){B=ah.verticalDragMinHeight}}V.height(B+"px");z=R-B}}function F(an,s){return function(){af(an,s);this.blur();return false}}function af(ao,s){var an=setInterval(function(){if(ao!=0){L(O+ao*ah.arrowButtonSpeed)}if(s!=0){K(p+s*ah.arrowButtonSpeed)}},ah.arrowRepeatFreq);b("html").bind("mouseup.jsp",function(){clearInterval(an);b("html").unbind("mouseup.jsp")})}function A(){b("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp")}function K(s){if(!ak){return}if(s<0){s=0}else{if(s>z){s=z}}p=s;V.css("top",s);U.scrollTop(0);var an=s/z;Z.css("top",-an*(Y-am))}function L(s){if(!m){return}if(s<0){s=0}else{if(s>C){s=C}}O=s;aj.css("left",s);U.scrollTop(0);var an=s/C;Z.css("left",-an*(ag-Q))}function v(s){var an=s/(Y-am);K(an*z)}function w(s){var an=s/(ag-Q);L(an*C)}function S(av,at){var aq,ao,s=0,an,ar,au;try{aq=b(av)}catch(ap){return}ao=aq.outerHeight();U.scrollTop(0);while(!aq.is(".jspPane")){s+=aq.position().top;aq=aq.offsetParent();if(/^body|html$/i.test(aq[0].nodeName)){return}}an=g();ar=an+am;if(s<an||at){au=s-ah.verticalGutter}else{if(s+ao>ar){au=s-am+ao+ah.verticalGutter}}if(au){v(au)}}function j(){return -Z.position().left}function g(){return -Z.position().top}function l(){U.bind("mousewheel.jsp",function(s,ao){var an=p;K(p-ao*ah.mouseWheelSpeed);return an==p})}function P(){U.unbind("mousewheel.jsp")}function ad(){return false}function t(){ac.find(":input,a").bind("focus.jsp",function(){S(this,false)})}function r(){ac.find(":input,a").unbind("focus.jsp")}function al(){if(location.hash&&location.hash.length>1){var ao,an;try{ao=b(location.hash)}catch(s){return}if(ao.length&&ac.find(ao)){if(U.scrollTop()==0){an=setInterval(function(){if(U.scrollTop()>0){S(location.hash,true);b(document).scrollTop(U.position().top);clearInterval(an)}},50)}else{S(location.hash,true);b(document).scrollTop(U.position().top)}}}}function u(){b("a[href^=#]").unbind("click.jsp-hijack")}function i(){b("a[href^=#]").unbind("click.jsp-hijack").bind("click.jsp-hijack",function(){var s=this.href.split("#"),an;if(s.length>1){an=s[1];if(an.length>0&&ac.find("#"+an).length>0){S("#"+an,true);return false}}})}b.extend(h,{reinitialise:function(an){an=b.extend({},an,ah);I(an)},scrollToElement:function(an,s){S(an,s)},scrollTo:function(an,s){w(an);v(s)},scrollToX:function(s){w(s)},scrollToY:function(s){v(s)},scrollBy:function(an,s){h.scrollByX(an);h.scrollByY(s)},scrollByX:function(s){var an=j()+s,ao=an/(ag-Q);L(ao*C)},scrollByY:function(s){var an=g()+s,ao=an/(Y-am);K(ao*z)},contentPositionX:function(){return j()},contentPositionY:function(){return g()},scrollToBottom:function(){K(z)},hijackInternalLinks:function(){i()}})}f=b.extend({},b.fn.jScrollPane.defaults,f);var e;this.each(function(){var g=b(this),h=g.data("jsp");if(h){h.reinitialise(f)}else{h=new d(g,f);g.data("jsp",h)}e=e?e.add(g):g});return e};b.fn.jScrollPane.defaults={showArrows:false,maintainPosition:true,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,hijackInternalLinks:false,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:10,arrowButtonSpeed:10,arrowRepeatFreq:100}})(jQuery,this);