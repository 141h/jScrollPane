/*
 * jScrollPane - v2.0.0beta2 - 2010-08-21
 * http://jscrollpane.kelvinluck.com/
 *
 * Copyright (c) 2010 Kelvin Luck
 * Dual licensed under the MIT and GPL licenses.
 */
(function(b,a,c){b.fn.jScrollPane=function(f){function d(ak,ah){var ar,h=this,ag,T,ay,Z,ap,af,F,q,av,m,aa,A,p,au,E,R,ai,X,o,U,D,ad,G,I,Q,n,K,y,at,z,L,C,ao,Y=wasAtLeft=true,ax=wasAtRight=false,N=b.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";L=ak.css("paddingTop")+" "+ak.css("paddingRight")+" "+ak.css("paddingBottom")+" "+ak.css("paddingLeft");C=(parseInt(ak.css("paddingLeft"))||0)+(parseInt(ak.css("paddingRight"))||0);J(ah);function J(aB){var aF,aE,aD,aA,az,aC;ar=aB;if(ag==c){ak.css({overflow:"hidden",padding:0});T=ak.innerWidth()+C;ay=ak.innerHeight();ak.width(T);ag=b('<div class="jspPane" />').wrap(b('<div class="jspContainer" />').css({width:T+"px",height:ay+"px"}));ak.wrapInner(ag.parent());Z=ak.find(">.jspContainer");ag=Z.find(">.jspPane");ag.css("padding",L)}else{ak.css("width",null);aC=ak.outerWidth()+C!=T||ak.outerHeight()!=ay;if(aC){T=ak.innerWidth()+C;ay=ak.innerHeight();Z.css({width:T+"px",height:ay+"px"})}ao=ag.innerWidth();if(!aC&&ag.outerWidth()==ap&&ag.outerHeight()==af){if(m||av){ag.css("width",ao+"px");ak.css("width",(ao+C)+"px")}return}ag.css("width",null);ak.css("width",(T+C)+"px");Z.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}aF=ag.clone().css("position","absolute");aE=b('<div style="width:1px; position: relative;" />').append(aF);b("body").append(aE);ap=Math.max(ag.outerWidth(),aF.outerWidth());aE.remove();af=ag.outerHeight();F=ap/T;q=af/ay;av=q>1;m=F>1;if(!(m||av)){ak.removeClass("jspScrollable");ag.css({top:0,width:Z.width()+"px"});S();r();u()}else{ak.addClass("jspScrollable");aD=ar.maintainPosition&&(p||R);if(aD){aA=j();az=g()}x();am();k();if(aD){w(aA);v(az)}t();l();aw();if(ar.hijackInternalLinks){i()}}if(ar.autoReinitialise&&!z){z=setInterval(function(){J(ar)},ar.autoReinitialiseDelay)}else{if(!ar.autoReinitialise&&z){clearInterval(z)}}ak.trigger("jsp-initialised",[m||av])}function x(){if(av){Z.append(b('<div class="jspVerticalBar" />').append(b('<div class="jspCap jspCapTop" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragTop" />'),b('<div class="jspDragBottom" />'))),b('<div class="jspCap jspCapBottom" />')));ai=Z.find(">.jspVerticalBar");X=ai.find(">.jspTrack");aa=X.find(">.jspDrag");if(ar.showArrows){ad=b('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",H(0,-1)).bind("click.jsp",al);G=b('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",H(0,1)).bind("click.jsp",al);if(ar.arrowScrollOnHover){ad.bind("mouseover.jsp",H(0,-1,ad));G.bind("mouseover.jsp",H(0,1,G))}W(X,ar.verticalArrowPositions,ad,G)}U=ay;Z.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){U-=b(this).outerHeight()});aa.hover(function(){aa.addClass("jspHover")},function(){aa.removeClass("jspHover")}).bind("mousedown.jsp",function(az){b("html").bind("dragstart.jsp selectstart.jsp",function(){return false});aa.addClass("jspActive");var s=az.pageY-aa.position().top;b("html").bind("mousemove.jsp",function(aA){M(aA.pageY-s,false)}).bind("mouseup.jsp mouseleave.jsp",B);return false});P();aj()}}function P(){X.height(U+"px");p=0;o=ar.verticalGutter+X.outerWidth();ag.width(T-o-C);if(ai.position().left==0){ag.css("margin-left",o+"px")}}function am(){if(m){Z.append(b('<div class="jspHorizontalBar" />').append(b('<div class="jspCap jspCapLeft" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragLeft" />'),b('<div class="jspDragRight" />'))),b('<div class="jspCap jspCapRight" />')));I=Z.find(">.jspHorizontalBar");Q=I.find(">.jspTrack");au=Q.find(">.jspDrag");if(ar.showArrows){y=b('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",H(-1,0)).bind("click.jsp",al);at=b('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",H(1,0)).bind("click.jsp",al);if(ar.arrowScrollOnHover){y.bind("mouseover.jsp",H(-1,0,y));
at.bind("mouseover.jsp",H(1,0,at))}W(Q,ar.horizontalArrowPositions,y,at)}au.hover(function(){au.addClass("jspHover")},function(){au.removeClass("jspHover")}).bind("mousedown.jsp",function(az){b("html").bind("dragstart.jsp selectstart.jsp",function(){return false});au.addClass("jspActive");var s=az.pageX-au.position().left;b("html").bind("mousemove.jsp",function(aA){O(aA.pageX-s,false)}).bind("mouseup.jsp mouseleave.jsp",B);return false});n=Z.innerWidth();ae();aq()}else{}}function ae(){Z.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){n-=b(this).outerWidth()});Q.width(n+"px");R=0}function k(){if(m&&av){var az=Q.outerHeight(),s=X.outerWidth();U-=az;b(I).find(">.jspCap:visible,>.jspArrow").each(function(){n+=b(this).outerWidth()});n-=s;ay-=s;T-=az;Q.parent().append(b('<div class="jspCorner" />').css("width",az+"px"));P();ae()}if(m){ag.width((Z.outerWidth()-C)+"px")}af=ag.outerHeight();q=af/ay;if(m){K=1/F*n;if(K>ar.horizontalDragMaxWidth){K=ar.horizontalDragMaxWidth}else{if(K<ar.horizontalDragMinWidth){K=ar.horizontalDragMinWidth}}au.width(K+"px");E=n-K}if(av){D=1/q*U;if(D>ar.verticalDragMaxHeight){D=ar.verticalDragMaxHeight}else{if(D<ar.verticalDragMinHeight){D=ar.verticalDragMinHeight}}aa.height(D+"px");A=U-D}}function W(aA,aC,az,s){var aE="before",aB="after",aD;if(aC=="os"){aC=/Mac/.test(navigator.platform)?"after":"split"}if(aC==aE){aB=aC}else{if(aC==aB){aE=aC;aD=az;az=s;s=aD}}aA[aE](az)[aB](s)}function H(az,s,aA){return function(){an(az,s,this,aA);this.blur();return false}}function an(aB,az,aE,aD){aE=b(aE).addClass("jspActive");var aC,s=function(){if(aB!=0){O(R+aB*ar.arrowButtonSpeed,false)}if(az!=0){M(p+az*ar.arrowButtonSpeed,false)}},aA=setInterval(s,ar.arrowRepeatFreq);s();aC=aD==c?"mouseup.jsp":"mouseout.jsp";aD=aD||b("html");aD.bind(aC,function(){aE.removeClass("jspActive");clearInterval(aA);aD.unbind(aC)})}function B(){b("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp");aa&&aa.removeClass("jspActive");au&&au.removeClass("jspActive")}function M(s,az){if(!av){return}if(s<0){s=0}else{if(s>A){s=A}}if(az==c){az=ar.animateScroll}if(az){h.animate(aa,"top",s,ab)}else{aa.css("top",s);ab(s)}}function ab(az){if(az==c){az=aa.position().top}Z.scrollTop(0);p=az;var aC=p==0,aA=p==A,aB=az/A,s=-aB*(af-ay);if(Y!=aC||ax!=aA){Y=aC;ax=aA;ak.trigger("jsp-arrow-change",[Y,ax,wasAtLeft,wasAtRight])}aj(aC,aA);ag.css("top",s);ak.trigger("jsp-scroll-y",[-s,aC,aA])}function O(az,s){if(!m){return}if(az<0){az=0}else{if(az>E){az=E}}if(s==c){s=ar.animateScroll}if(s){h.animate(au,"left",az,ac)}else{au.css("left",az);ac(az)}}function ac(az){if(az==c){az=au.position().left}Z.scrollTop(0);R=az;var aC=R==0,aB=R==A,aA=az/E,s=-aA*(ap-T);if(wasAtLeft!=aC||wasAtRight!=aB){wasAtLeft=aC;wasAtRight=aB;ak.trigger("jsp-arrow-change",[Y,ax,wasAtLeft,wasAtRight])}aq(aC,aB);ag.css("left",s);ak.trigger("jsp-scroll-x",[-s,aC,aB])}function aj(az,s){if(ar.showArrows){ad[az?"addClass":"removeClass"]("jspDisabled");G[s?"addClass":"removeClass"]("jspDisabled")}}function aq(az,s){if(ar.showArrows){y[az?"addClass":"removeClass"]("jspDisabled");at[s?"addClass":"removeClass"]("jspDisabled")}}function v(s,az){var aA=s/(af-ay);M(aA*A,az)}function w(az,s){var aA=az/(ap-T);O(aA*E,s)}function V(aH,aF,az){var aD,aB,s=0,aA,aE,aG;try{aD=b(aH)}catch(aC){return}aB=aD.outerHeight();Z.scrollTop(0);while(!aD.is(".jspPane")){s+=aD.position().top;aD=aD.offsetParent();if(/^body|html$/i.test(aD[0].nodeName)){return}}aA=g();aE=aA+ay;if(s<aA||aF){aG=s-ar.verticalGutter}else{if(s+aB>aE){aG=s-ay+aB+ar.verticalGutter}}if(aG){v(aG,az)}}function j(){return -ag.position().left}function g(){return -ag.position().top}function l(){Z.unbind(N).bind(N,function(aC,aD,aB,az){var aA=R,s=p;O(R+aB*ar.mouseWheelSpeed,false);M(p-az*ar.mouseWheelSpeed,false);return aA==R&&s==p})}function S(){Z.unbind(N)}function al(){return false}function t(){ag.unbind("focusin.jsp").bind("focusin.jsp",function(s){V(s.target,false)})}function r(){ag.unbind("focusin.jsp")
}function aw(){if(location.hash&&location.hash.length>1){var aA,az;try{aA=b(location.hash)}catch(s){return}if(aA.length&&ag.find(aA)){if(Z.scrollTop()==0){az=setInterval(function(){if(Z.scrollTop()>0){V(location.hash,true);b(document).scrollTop(Z.position().top);clearInterval(az)}},50)}else{V(location.hash,true);b(document).scrollTop(Z.position().top)}}}}function u(){b("a.jspHijack").unbind("click.jsp-hijack").removeClass("jspHijack")}function i(){u();b("a[href^=#]").addClass("jspHijack").bind("click.jsp-hijack",function(){var s=this.href.split("#"),az;if(s.length>1){az=s[1];if(az.length>0&&ag.find("#"+az).length>0){V("#"+az,true);return false}}})}b.extend(h,{reinitialise:function(az){az=b.extend({},az,ar);J(az)},scrollToElement:function(aA,az,s){V(aA,az,s)},scrollTo:function(aA,s,az){w(aA,az);v(s,az)},scrollToX:function(az,s){w(az,s)},scrollToY:function(s,az){v(s,az)},scrollBy:function(az,s,aA){h.scrollByX(az,aA);h.scrollByY(s,aA)},scrollByX:function(s,aA){var az=j()+s,aB=az/(ap-T);O(aB*E,aA)},scrollByY:function(s,aA){var az=g()+s,aB=az/(af-ay);M(aB*A,aA)},animate:function(az,aC,s,aB){var aA={};aA[aC]=s;az.animate(aA,{duration:ar.animateDuration,ease:ar.animateEase,queue:false,step:aB})},getContentPositionX:function(){return j()},getContentPositionY:function(){return g()},getIsScrollableH:function(){return m},getIsScrollableV:function(){return av},getContentPane:function(){return ag},scrollToBottom:function(s){M(A,s)},hijackInternalLinks:function(){i()}})}f=b.extend({},b.fn.jScrollPane.defaults,f);var e;this.each(function(){var g=b(this),h=g.data("jsp");if(h){h.reinitialise(f)}else{h=new d(g,f);g.data("jsp",h)}e=e?e.add(g):g});return e};b.fn.jScrollPane.defaults={showArrows:false,maintainPosition:true,autoReinitialise:false,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,animateScroll:false,animateDuration:300,animateEase:"linear",hijackInternalLinks:false,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:10,arrowButtonSpeed:10,arrowRepeatFreq:100,arrowScrollOnHover:false,verticalArrowPositions:"split",horizontalArrowPositions:"split"}})(jQuery,this);