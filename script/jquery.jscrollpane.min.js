/*
 * jScrollPane - v2.0.0beta1 - 2010-08-05
 * http://jscrollpane.kelvinluck.com/
 *
 * Copyright (c) 2010 Kelvin Luck
 * Dual licensed under the MIT and GPL licenses.
 */
(function(b,a,c){b.fn.jScrollPane=function(f){function d(W,ab){var g=this,U,C,L,af,P,aa,T,y,n,ae,j,Q,u,m,ad,x,J,V,O,l,M,w,R,z,B,I,k,E,t,ac;C={};D(ab);function D(ag){var ak,aj,ai,ah;if(U==c){W.css("overflow","hidden");L=W.innerWidth();af=W.innerHeight();U=b('<div class="jspPane" />').wrap(b('<div class="jspContainer" />').css({width:L+"px",height:af+"px"}));W.css("overflow","visible");W.wrap(U.parent());U=W.parent();P=U.parent();ai=W.find(":first-child");ah=W.find(":last-child");P.css({"margin-top":ai.css("margin-top"),"margin-bottom":ah.css("margin-bottom")});ai.css("margin-top",0);ah.css("margin-bottom",0)}else{L=P.outerWidth();af=P.outerHeight();P.find(".jspVerticalBar,.jspHorizontalBar").remove().end()}W.css({width:"auto",height:"auto"});ak=W.clone().css("position","absolute");aj=b('<div style="width:1px; position: relative;" />').append(ak);b("body").append(aj);aa=Math.max(W.outerWidth(),ak.outerWidth());aj.remove();T=W.outerHeight();y=aa/L;n=T/af;ae=n>1;j=y>1;if(!(j||ae)){W.removeClass("jspScrollable");U.css("top",0);K();o()}else{W.addClass("jspScrollable");s();Y();h();p()}}function s(){if(ae){P.append(b('<div class="jspVerticalBar" />').append(b('<div class="jspCap jspCapTop" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragTop" />'),b('<div class="jspDragBottom" />'))),b('<div class="jspCap jspCapBottom" />')));V=P.find(">.jspVerticalBar");O=V.find(">.jspTrack");Q=O.find(">.jspDrag");if(ab.showArrows){R=b('<a href="#" class="jspArrow jspArrowUp">Scroll up</a>').bind("mousedown.jsp",A(0,-1)).bind("click.jsp",X);z=b('<a href="#" class="jspArrow jspArrowDown">Scroll down</a>').bind("mousedown.jsp",A(0,1)).bind("click.jsp",X);O.before(R).after(z)}M=af;P.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){M-=b(this).outerHeight()});Q.hover(function(){Q.addClass("jspHover")},function(){Q.removeClass("jspHover")}).bind("mousedown.jsp",function(ah){b("html").bind("dragstart.jsp selectstart.jsp",function(){return false});var ag=ah.pageY-Q.position().top;b("html").bind("mousemove.jsp",function(ai){F(ai.pageY-ag)}).bind("mouseup.jsp mouseleave.jsp",v);return false});H();i()}else{K()}}function H(){O.height(M+"px");m=0;l=ab.verticalGutter+O.outerWidth();U.width(L-l);if(V.position().left==0){U.css("margin-left",l+"px")}}function Y(){if(j){P.append(b('<div class="jspHorizontalBar" />').append(b('<div class="jspCap jspCapLeft" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragLeft" />'),b('<div class="jspDragRight" />'))),b('<div class="jspCap jspCapRight" />')));B=P.find(">.jspHorizontalBar");I=B.find(">.jspTrack");ad=I.find(">.jspDrag");if(ab.showArrows){t=b('<a href="#" class="jspArrow jspArrowLeft">Scroll left</a>').bind("mousedown.jsp",A(-1,0)).bind("click.jsp",X);ac=b('<a href="#" class="jspArrow jspArrowRight">Scroll right</a>').bind("mousedown.jsp",A(1,0)).bind("click.jsp",X);I.before(t).after(ac)}ad.hover(function(){ad.addClass("jspHover")},function(){ad.removeClass("jspHover")}).bind("mousedown.jsp",function(ah){b("html").bind("dragstart.jsp selectstart.jsp",function(){return false});var ag=ah.pageX-ad.position().left;b("html").bind("mousemove.jsp",function(ai){G(ai.pageX-ag)}).bind("mouseup.jsp mouseleave.jsp",v);return false});k=P.innerWidth();S()}else{}}function S(){U.height(af-ab.horizontalGutter-I.outerHeight());P.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){k-=b(this).outerWidth()});I.width(k+"px");J=0}function h(){if(j&&ae){var ah=I.outerHeight(),ag=O.outerWidth();M-=ah;b(B).find(">.jspCap:visible,>.jspArrow").each(function(){k+=b(this).outerWidth()});k-=ag;af-=ag;L-=ah;I.parent().append(b('<div class="jspCorner" />').css("width",ah+"px"));H();S()}if(j){U.width(P.outerWidth()+"px")
}T=W.outerHeight();n=T/af;if(j){E=1/y*k;ad.width(E+"px");x=k-E}if(ae){w=1/n*M;Q.height(w+"px");u=M-w}}function A(ah,ag){return function(){Z(ah,ag);this.blur();return false}}function Z(ai,ag){var ah=setInterval(function(){if(ai!=0){G(J+ai*ab.arrowButtonSpeed)}if(ag!=0){F(m+ag*ab.arrowButtonSpeed)}},ab.arrowRepeatFreq);b("html").bind("mouseup.jsp",function(){clearInterval(ah);b("html").unbind("mouseup.jsp")})}function v(){b("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp")}function F(ag){if(ag<0){ag=0}else{if(ag>u){ag=u}}m=ag;Q.css("top",ag);P.scrollTop(0);var ah=ag/u;U.css("top",-ah*(T-af))}function G(ag){if(ag<0){ag=0}else{if(ag>x){ag=x}}J=ag;ad.css("left",ag);P.scrollTop(0);var ah=ag/x;U.css("left",-ah*(aa-L))}function q(ag){var ah=ag/(T-af);F(ah*u)}function r(ag){var ah=ag/(aa-L);G(ah*x)}function N(ai){var al=b(ai),am=al.outerHeight(),ak=0,ag,aj,ah;while(!al.is(".jspPane")){ak+=al.position().top;al=al.offsetParent();if(/^body|html$/i.test(al[0].nodeName)){return}}P.scrollTop(0);ag=-U.position().top;aj=ag+af;if(ak<ag){ah=ak-ab.verticalGutter}else{if(ak+am>aj){ah=ak-af+am+ab.verticalGutter}}if(ah){q(ah)}}function i(){P.bind("mousewheel.jsp",function(ag,ai){var ah=m;F(m-ai*ab.mouseWheelSpeed);return ah==m})}function K(){P.unbind("mousewheel.jsp")}function X(){return false}function p(){W.find(":input,a").bind("focus.jsp",function(){N(this)})}function o(){W.find(":input,a").unbind("focus.jsp")}b.extend(g,{reinitialise:function(ag){D(ag)},scrollToElement:function(ag){N(ag)},scrollToY:function(ag){q(ag)},scrollToX:function(ag){r(ag)},scrollToBottom:function(){F(u)}})}f=b.extend({},b.fn.jScrollPane.defaults,f);var e;this.each(function(){var g=b(this),h=g.data("jsp");if(h){h.reinitialise(f)}else{h=new d(g,f);g.data("jsp",h)}e=e?e.add(g):g});return e};b.fn.jScrollPane.defaults={showArrows:false,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:10,arrowButtonSpeed:10,arrowRepeatFreq:100}})(jQuery,this);