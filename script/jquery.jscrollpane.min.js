/*
 * jScrollPane - v2.0.0beta1 - 2010-08-06
 * http://jscrollpane.kelvinluck.com/
 *
 * Copyright (c) 2010 Kelvin Luck
 * Dual licensed under the MIT and GPL licenses.
 */
(function(b,a,c){b.fn.jScrollPane=function(f){function d(ag,ad){var am,h=this,ac,I,R,ar,V,ak,ab,E,q,ap,m,W,A,p,ao,D,P,ae,U,o,S,C,Z,F,H,O,n,K,y,an,z;I={};J(ad);function J(av){var aA,az,ay,aw,ax,au,at;am=av;if(ac==c){ag.css("overflow","hidden");R=ag.innerWidth();ar=ag.innerHeight();ac=b('<div class="jspPane" />').wrap(b('<div class="jspContainer" />').css({width:R+"px",height:ar+"px"}));ag.css("overflow","visible");ag.wrap(ac.parent());ac=ag.parent();V=ac.parent();ay=ag.find(":first-child");aw=ag.find(":last-child");V.css({"margin-top":ay.css("margin-top"),"margin-bottom":aw.css("margin-bottom")});ay.css("margin-top",0);aw.css("margin-bottom",0)}else{if(ag.outerWidth()==ak&&ag.outerHeight()==ab){return}R=V.outerWidth();ar=V.outerHeight();V.find(".jspVerticalBar,.jspHorizontalBar").remove().end()}ag.css({width:"auto",height:"auto"});aA=ag.clone().css("position","absolute");az=b('<div style="width:1px; position: relative;" />').append(aA);b("body").append(az);ak=Math.max(ag.outerWidth(),aA.outerWidth());az.remove();ab=ag.outerHeight();E=ak/R;q=ab/ar;ap=q>1;m=E>1;if(!(m||ap)){ag.removeClass("jspScrollable");ac.css("top",0);Q();r();u()}else{ag.addClass("jspScrollable");ax=am.maintainPosition&&(p||P);if(ax){au=j();at=g()}x();ai();k();if(ax){w(au);v(at)}t();aq();if(am.hijackInternalLinks){i()}}if(am.autoReinitialise&&!z){z=setInterval(function(){J(am)},am.autoReinitialiseDelay)}else{if(!am.autoReinitialise&&z){clearInterval(z)}}}function x(){if(ap){V.append(b('<div class="jspVerticalBar" />').append(b('<div class="jspCap jspCapTop" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragTop" />'),b('<div class="jspDragBottom" />'))),b('<div class="jspCap jspCapBottom" />')));ae=V.find(">.jspVerticalBar");U=ae.find(">.jspTrack");W=U.find(">.jspDrag");if(am.showArrows){Z=b('<a href="#" class="jspArrow jspArrowUp">Scroll up</a>').bind("mousedown.jsp",G(0,-1)).bind("click.jsp",ah);F=b('<a href="#" class="jspArrow jspArrowDown">Scroll down</a>').bind("mousedown.jsp",G(0,1)).bind("click.jsp",ah);U.before(Z).after(F)}S=ar;V.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){S-=b(this).outerHeight()});W.hover(function(){W.addClass("jspHover")},function(){W.removeClass("jspHover")}).bind("mousedown.jsp",function(at){b("html").bind("dragstart.jsp selectstart.jsp",function(){return false});W.addClass("jspActive");var s=at.pageY-W.position().top;b("html").bind("mousemove.jsp",function(au){L(au.pageY-s,false)}).bind("mouseup.jsp mouseleave.jsp",B);return false});N();af();l()}else{Q()}}function N(){U.height(S+"px");p=0;o=am.verticalGutter+U.outerWidth();ac.width(R-o);if(ae.position().left==0){ac.css("margin-left",o+"px")}}function ai(){if(m){V.append(b('<div class="jspHorizontalBar" />').append(b('<div class="jspCap jspCapLeft" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragLeft" />'),b('<div class="jspDragRight" />'))),b('<div class="jspCap jspCapRight" />')));H=V.find(">.jspHorizontalBar");O=H.find(">.jspTrack");ao=O.find(">.jspDrag");if(am.showArrows){y=b('<a href="#" class="jspArrow jspArrowLeft">Scroll left</a>').bind("mousedown.jsp",G(-1,0)).bind("click.jsp",ah);an=b('<a href="#" class="jspArrow jspArrowRight">Scroll right</a>').bind("mousedown.jsp",G(1,0)).bind("click.jsp",ah);O.before(y).after(an)}ao.hover(function(){ao.addClass("jspHover")},function(){ao.removeClass("jspHover")}).bind("mousedown.jsp",function(at){b("html").bind("dragstart.jsp selectstart.jsp",function(){return false});ao.addClass("jspActive");var s=at.pageX-ao.position().left;b("html").bind("mousemove.jsp",function(au){M(au.pageX-s,false)}).bind("mouseup.jsp mouseleave.jsp",B);return false});n=V.innerWidth();aa();al()}else{}}function aa(){ac.height(ar-am.horizontalGutter-O.outerHeight());
V.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){n-=b(this).outerWidth()});O.width(n+"px");P=0}function k(){if(m&&ap){var at=O.outerHeight(),s=U.outerWidth();S-=at;b(H).find(">.jspCap:visible,>.jspArrow").each(function(){n+=b(this).outerWidth()});n-=s;ar-=s;R-=at;O.parent().append(b('<div class="jspCorner" />').css("width",at+"px"));N();aa()}if(m){ac.width(V.outerWidth()+"px")}ab=ag.outerHeight();q=ab/ar;if(m){K=1/E*n;if(K>am.horizontalDragMaxWidth){K=am.horizontalDragMaxWidth}else{if(K<am.horizontalDragMinWidth){K=am.horizontalDragMinWidth}}ao.width(K+"px");D=n-K}if(ap){C=1/q*S;if(C>am.verticalDragMaxHeight){C=am.verticalDragMaxHeight}else{if(C<am.verticalDragMinHeight){C=am.verticalDragMinHeight}}W.height(C+"px");A=S-C}}function G(at,s){return function(){aj(at,s,this);this.blur();return false}}function aj(au,s,av){av=b(av).addClass("jspActive");var at=setInterval(function(){if(au!=0){M(P+au*am.arrowButtonSpeed,false)}if(s!=0){L(p+s*am.arrowButtonSpeed,false)}},am.arrowRepeatFreq);b("html").bind("mouseup.jsp",function(){av.removeClass("jspActive");clearInterval(at);b("html").unbind("mouseup.jsp")})}function B(){b("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp");W&&W.removeClass("jspActive");ao&&ao.removeClass("jspActive")}function L(s,at){if(!ap){return}if(s<0){s=0}else{if(s>A){s=A}}if(at==c){at=am.animateScroll}if(at){h.animate(W,"top",s,X)}else{W.css("top",s);X(s)}}function X(at){if(at==c){at=W.position().top}V.scrollTop(0);p=at;af();var au=at/A,s=-au*(ab-ar);ac.css("top",s)}function M(at,s){if(!m){return}if(at<0){at=0}else{if(at>D){at=D}}if(s==c){s=am.animateScroll}if(s){h.animate(ao,"left",at,Y)}else{ao.css("left",at);Y(at)}}function Y(at){if(at==c){at=ao.position().left}V.scrollTop(0);P=at;al();var au=at/D,s=-au*(ak-R);ac.css("left",s)}function af(){if(am.showArrows){Z[p==0?"addClass":"removeClass"]("jspDisabled");F[p==A?"addClass":"removeClass"]("jspDisabled")}}function al(){if(am.showArrows){y[P==0?"addClass":"removeClass"]("jspDisabled");an[P==D?"addClass":"removeClass"]("jspDisabled")}}function v(s,at){var au=s/(ab-ar);L(au*A,at)}function w(at,s){var au=at/(ak-R);M(au*D,s)}function T(aB,az,at){var ax,av,s=0,au,ay,aA;try{ax=b(aB)}catch(aw){return}av=ax.outerHeight();V.scrollTop(0);while(!ax.is(".jspPane")){s+=ax.position().top;ax=ax.offsetParent();if(/^body|html$/i.test(ax[0].nodeName)){return}}au=g();ay=au+ar;if(s<au||az){aA=s-am.verticalGutter}else{if(s+av>ay){aA=s-ar+av+am.verticalGutter}}if(aA){v(aA,at)}}function j(){return -ac.position().left}function g(){return -ac.position().top}function l(){V.unbind("mousewheel.jsp").bind("mousewheel.jsp",function(s,au){var at=p;L(p-au*am.mouseWheelSpeed,false);return at==p})}function Q(){V.unbind("mousewheel.jsp")}function ah(){return false}function t(){ag.find(":input,a").bind("focus.jsp",function(){T(this,false)})}function r(){ag.find(":input,a").unbind("focus.jsp")}function aq(){if(location.hash&&location.hash.length>1){var au,at;try{au=b(location.hash)}catch(s){return}if(au.length&&ag.find(au)){if(V.scrollTop()==0){at=setInterval(function(){if(V.scrollTop()>0){T(location.hash,true);b(document).scrollTop(V.position().top);clearInterval(at)}},50)}else{T(location.hash,true);b(document).scrollTop(V.position().top)}}}}function u(){b("a[href^=#]").unbind("click.jsp-hijack")}function i(){b("a[href^=#]").unbind("click.jsp-hijack").bind("click.jsp-hijack",function(){var s=this.href.split("#"),at;if(s.length>1){at=s[1];if(at.length>0&&ag.find("#"+at).length>0){T("#"+at,true);return false}}})}b.extend(h,{reinitialise:function(at){at=b.extend({},at,am);J(at)},scrollToElement:function(au,at,s){T(au,at,s)},scrollTo:function(au,s,at){w(au,at);v(s,at)},scrollToX:function(at,s){w(at,s)},scrollToY:function(s,at){v(s,at)},scrollBy:function(at,s,au){h.scrollByX(at,au);h.scrollByY(s,au)},scrollByX:function(s,au){var at=j()+s,av=at/(ak-R);M(av*D,au)},scrollByY:function(s,au){var at=g()+s,av=at/(ab-ar);L(av*A,au)},animate:function(at,aw,s,av){var au={};
au[aw]=s;at.animate(au,{duration:am.animateDuration,ease:am.animateEase,queue:false,step:av})},getContentPositionX:function(){return j()},getContentPositionY:function(){return g()},scrollToBottom:function(s){L(A,s)},hijackInternalLinks:function(){i()}})}f=b.extend({},b.fn.jScrollPane.defaults,f);var e;this.each(function(){var g=b(this),h=g.data("jsp");if(h){h.reinitialise(f)}else{h=new d(g,f);g.data("jsp",h)}e=e?e.add(g):g});return e};b.fn.jScrollPane.defaults={showArrows:false,maintainPosition:true,autoReinitialise:false,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,animateScroll:false,animateDuration:300,animateEase:"linear",hijackInternalLinks:false,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:10,arrowButtonSpeed:10,arrowRepeatFreq:100}})(jQuery,this);