/*
 * jScrollPane - v2.0.0beta6 - 2010-12-07
 * http://jscrollpane.kelvinluck.com/
 *
 * Copyright (c) 2010 Kelvin Luck
 * Dual licensed under the MIT and GPL licenses.
 */
(function(c,La,Q){c.fn.jScrollPane=function(I){function Aa(f,L){function ha(a){var b,e,g;d=a;if(h===Q){f.css({overflow:"hidden",padding:0});m=f.innerWidth()+C;l=f.innerHeight();f.width(m);h=c('<div class="jspPane" />').wrap(c('<div class="jspContainer" />').css({width:m+"px",height:l+"px"}));f.wrapInner(h.parent());i=f.find(">.jspContainer");h=i.find(">.jspPane");h.css("padding",qa)}else{f.css("width","");if(a=f.outerWidth()+C!=m||f.outerHeight()!=l){m=f.innerWidth()+C;l=f.innerHeight();i.css({width:m+
"px",height:l+"px"})}if(!a&&ra==D&&h.outerHeight()==w){if(x||y)f.css("width",m+C+"px");return}ra=D;h.css("width","");f.css("width",m+"px");i.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}a=h.clone().css("position","absolute");b=c('<div style="width:1px; position: relative;" />').append(a);c("body").append(b);D=Math.max(h.outerWidth(),a.outerWidth());b.remove();w=h.outerHeight();ia=D/m;X=w/l;y=X>1;if((x=ia>1)||y){f.addClass("jspScrollable");if(a=d.maintainPosition&&(q||r)){e=-h.position().left;
g=-h.position().top}Ba();Ca();Da();if(a){Y(e);M(g)}Ea();Fa();d.enableKeyboardNavigation&&Ga();d.clickOnTrack&&Ha();Ia();d.hijackInternalLinks&&sa()}else{f.removeClass("jspScrollable");h.css({top:0,width:i.width()-C});i.unbind(ja);h.unbind("focusin.jsp");f.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keyup.jsp");ta();ua()}if(d.autoReinitialise&&!Z)Z=setInterval(function(){ha(d)},d.autoReinitialiseDelay);else!d.autoReinitialise&&Z&&clearInterval(Z);f.trigger("jsp-initialised",[x||
y])}function Ba(){if(y){i.append(c('<div class="jspVerticalBar" />').append(c('<div class="jspCap jspCapTop" />'),c('<div class="jspTrack" />').append(c('<div class="jspDrag" />').append(c('<div class="jspDragTop" />'),c('<div class="jspDragBottom" />'))),c('<div class="jspCap jspCapBottom" />')));ka=i.find(">.jspVerticalBar");z=ka.find(">.jspTrack");t=z.find(">.jspDrag");if(d.showArrows){R=c('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",E(0,-1)).bind("click.jsp",$);S=c('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",
E(0,1)).bind("click.jsp",$);if(d.arrowScrollOnHover){R.bind("mouseover.jsp",E(0,-1,R));S.bind("mouseover.jsp",E(0,1,S))}va(z,d.verticalArrowPositions,R,S)}N=l;i.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){N-=c(this).outerHeight()});t.hover(function(){t.addClass("jspHover")},function(){t.removeClass("jspHover")}).bind("mousedown.jsp",function(a){c("html").bind("dragstart.jsp selectstart.jsp",function(){return false});t.addClass("jspActive");var b=a.pageY-t.position().top;
c("html").bind("mousemove.jsp",function(e){O(e.pageY-b,false)}).bind("mouseup.jsp mouseleave.jsp",wa);return false});xa()}}function xa(){z.height(N+"px");q=0;la=d.verticalGutter+z.outerWidth();h.width(m-la-C);ka.position().left===0&&h.css("margin-left",la+"px")}function Ca(){if(x){i.append(c('<div class="jspHorizontalBar" />').append(c('<div class="jspCap jspCapLeft" />'),c('<div class="jspTrack" />').append(c('<div class="jspDrag" />').append(c('<div class="jspDragLeft" />'),c('<div class="jspDragRight" />'))),
c('<div class="jspCap jspCapRight" />')));ma=i.find(">.jspHorizontalBar");A=ma.find(">.jspTrack");u=A.find(">.jspDrag");if(d.showArrows){T=c('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",E(-1,0)).bind("click.jsp",$);U=c('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",E(1,0)).bind("click.jsp",$);if(d.arrowScrollOnHover){T.bind("mouseover.jsp",E(-1,0,T));U.bind("mouseover.jsp",E(1,0,U))}va(A,d.horizontalArrowPositions,T,U)}u.hover(function(){u.addClass("jspHover")},function(){u.removeClass("jspHover")}).bind("mousedown.jsp",
function(a){c("html").bind("dragstart.jsp selectstart.jsp",function(){return false});u.addClass("jspActive");var b=a.pageX-u.position().left;c("html").bind("mousemove.jsp",function(e){V(e.pageX-b,false)}).bind("mouseup.jsp mouseleave.jsp",wa);return false});J=i.innerWidth();ya()}}function ya(){i.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){J-=c(this).outerWidth()});A.width(J+"px");r=0}function Da(){if(x&&y){var a=A.outerHeight(),b=z.outerWidth();N-=a;c(ma).find(">.jspCap:visible,>.jspArrow").each(function(){J+=
c(this).outerWidth()});J-=b;l-=b;m-=a;A.parent().append(c('<div class="jspCorner" />').css("width",a+"px"));xa();ya()}x&&h.width(i.outerWidth()-C+"px");w=h.outerHeight();X=w/l;if(x){F=1/ia*J;if(F>d.horizontalDragMaxWidth)F=d.horizontalDragMaxWidth;else if(F<d.horizontalDragMinWidth)F=d.horizontalDragMinWidth;u.width(F+"px");G=J-F;na(r)}if(y){H=1/X*N;if(H>d.verticalDragMaxHeight)H=d.verticalDragMaxHeight;else if(H<d.verticalDragMinHeight)H=d.verticalDragMinHeight;t.height(H+"px");B=N-H;oa(q)}}function va(a,
b,e,g){var j="before",k="after";if(b=="os")b=/Mac/.test(navigator.platform)?"after":"split";if(b==j)k=b;else if(b==k){j=b;b=e;e=g;g=b}a[j](e)[k](g)}function E(a,b,e){return function(){Ja(a,b,this,e);this.blur();return false}}function Ja(a,b,e,g){function j(){p=setTimeout(j,s?d.initialDelay:d.arrowRepeatFreq);s=false;a!==0&&n.scrollByX(a*d.arrowButtonSpeed);b!==0&&n.scrollByY(b*d.arrowButtonSpeed)}e=c(e).addClass("jspActive");var k,p,s=true;j();k=g?"mouseout.jsp":"mouseup.jsp";g=g||c("html");g.bind(k,
function(){e.removeClass("jspActive");if(p){clearTimeout(p);p=null}g.unbind(k);aa()})}function Ha(){ta();y&&z.bind("mousedown.jsp",function(a){if(!a.originalTarget||a.originalTarget==a.currentTarget){var b=c(this),e=b.offset(),g=a.pageY-e.top-q,j,k=true,p=function(){j=setTimeout(p,k?d.initialDelay:d.trackClickRepeatFreq);k=false;var o=b.offset();o=a.pageY-o.top-H/2;var v=l*d.scrollPagePercent,P=B*v/(w-l);if(g<0)q-P>o?n.scrollByY(-v):O(o);else if(g>0)q+P<o?n.scrollByY(v):O(o);else s()},s=function(){if(j){clearTimeout(j);
j=null}c(document).unbind("mouseup.jsp",s);aa()};p();c(document).bind("mouseup.jsp",s);return false}});x&&A.bind("mousedown.jsp",function(a){if(!a.originalTarget||a.originalTarget==a.currentTarget){var b=c(this),e=b.offset(),g=a.pageX-e.left-r,j,k=true,p=function(){j=setTimeout(p,k?d.initialDelay:d.trackClickRepeatFreq);k=false;var o=b.offset();o=a.pageX-o.left-F/2;var v=m*d.scrollPagePercent,P=G*v/(D-m);if(g<0)r-P>o?n.scrollByX(-v):V(o);else if(g>0)r+P<o?n.scrollByX(v):V(o);else s()},s=function(){if(j){clearTimeout(j);
j=null}c(document).unbind("mouseup.jsp",s);aa()};p();c(document).bind("mouseup.jsp",s);return false}})}function ta(){A&&A.unbind("mousedown.jsp");z&&z.unbind("mousedown.jsp")}function wa(){c("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp");t&&t.removeClass("jspActive");u&&u.removeClass("jspActive");aa()}function O(a,b){if(y){if(a<0)a=0;else if(a>B)a=B;if(b===Q)b=d.animateScroll;if(b)n.animate(t,"top",a,oa);else{t.css("top",a);oa(a)}}}function oa(a){if(a===Q)a=
t.position().top;i.scrollTop(0);q=a;var b=q===0,e=q==B;a=-(a/B)*(w-l);if(ba!=b||ca!=e){ba=b;ca=e;f.trigger("jsp-arrow-change",[ba,ca,da,ea])}if(d.showArrows){R[b?"addClass":"removeClass"]("jspDisabled");S[e?"addClass":"removeClass"]("jspDisabled")}h.css("top",a);f.trigger("jsp-scroll-y",[-a,b,e])}function V(a,b){if(x){if(a<0)a=0;else if(a>G)a=G;if(b===Q)b=d.animateScroll;if(b)n.animate(u,"left",a,na);else{u.css("left",a);na(a)}}}function na(a){if(a===Q)a=u.position().left;i.scrollTop(0);r=a;var b=
r===0,e=r==G;a=-(a/G)*(D-m);if(da!=b||ea!=e){da=b;ea=e;f.trigger("jsp-arrow-change",[ba,ca,da,ea])}if(d.showArrows){T[b?"addClass":"removeClass"]("jspDisabled");U[e?"addClass":"removeClass"]("jspDisabled")}h.css("left",a);f.trigger("jsp-scroll-x",[-a,b,e])}function M(a,b){O(a/(w-l)*B,b)}function Y(a,b){V(a/(D-m)*G,b)}function W(a,b,e){var g,j,k=0,p=0,s,o,v;try{g=c(a)}catch(P){return}j=g.outerHeight();a=g.outerWidth();i.scrollTop(0);for(i.scrollLeft(0);!g.is(".jspPane");){k+=g.position().top;p+=g.position().left;
g=g.offsetParent();if(/^body|html$/i.test(g[0].nodeName))return}g=-h.position().top;s=g+l;if(k<g||b)o=k-d.verticalGutter;else if(k+j>s)o=k-l+j+d.verticalGutter;o&&M(o,e);viewportLeft=-h.position().left;k=viewportLeft+m;if(p<viewportLeft||b)v=p-d.horizontalGutter;else if(p+a>k)v=p-m+a+d.horizontalGutter;v&&Y(v,e)}function Fa(){i.unbind(ja).bind(ja,function(a,b,e,g){a=r;b=q;n.scrollBy(-e*d.mouseWheelSpeed,-g*d.mouseWheelSpeed);return a==r&&b==q})}function $(){return false}function Ea(){h.unbind("focusin.jsp").bind("focusin.jsp",
function(a){a.target!==this&&W(a.target,false)})}function Ka(){var a=r,b=q;switch(K){case 40:n.scrollByY(d.keyboardSpeed);break;case 38:n.scrollByY(-d.keyboardSpeed);break;case 34:case 32:n.scrollByY(l*d.scrollPagePercent);break;case 33:n.scrollByY(-l*d.scrollPagePercent);break;case 39:n.scrollByX(d.keyboardSpeed);break;case 37:n.scrollByX(-d.keyboardSpeed)}return a!=r||b!=q}function za(a){fa=setTimeout(function(){za()},a?d.initialDelay:d.keyboardRepeatFreq);Ka()||pa()}function pa(){K=null;if(fa){clearTimeout(fa);
fa=null}}function Ga(){h.focus(function(){f.focus()});f.attr("tabindex",0).unbind("keydown.jsp keyup.jsp").bind("keydown.jsp",function(a){if(a.target===this){var b=r,e=q;switch(a.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:if(K!=a.keyCode){pa();K=a.keyCode;za(true)}break;case 35:M(w-l);K=null;break;case 36:M(0);K=null}if(K==a.keyCode||b!=r||e!=q)return false}}).bind("keyup.jsp",function(){pa()});if(d.hideFocus){f.css("outline","none");"hideFocus"in i[0]&&f.attr("hideFocus",true)}else{f.css("outline",
"");"hideFocus"in i[0]&&f.attr("hideFocus",false)}}function Ia(){if(location.hash&&location.hash.length>1){var a,b;try{a=c(location.hash)}catch(e){return}if(a.length&&h.find(a))if(i.scrollTop()===0)b=setInterval(function(){if(i.scrollTop()>0){W(location.hash,true);c(document).scrollTop(i.position().top);clearInterval(b)}},50);else{W(location.hash,true);c(document).scrollTop(i.position().top)}}}function ua(){c("a.jspHijack").unbind("click.jsp-hijack").removeClass("jspHijack")}function sa(){ua();c("a[href^=#]").addClass("jspHijack").bind("click.jsp-hijack",
function(){var a=this.href.split("#");if(a.length>1){a=a[1];if(a.length>0&&h.find("#"+a).length>0){W("#"+a,true);return false}}})}function aa(){c(":focus").length||f.focus()}var d,n=this,h,m,l,i,D,w,ia,X,y,x,t,B,q,u,G,r,ka,z,la,N,H,R,S,ma,A,J,F,T,U,Z,qa,C,ra,ba=true,da=true,ca=false,ea=false,K,fa,ja=c.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";qa=f.css("paddingTop")+" "+f.css("paddingRight")+" "+f.css("paddingBottom")+" "+f.css("paddingLeft");C=(parseInt(f.css("paddingLeft"),10)||0)+(parseInt(f.css("paddingRight"),
10)||0);c.extend(n,{reinitialise:function(a){a=c.extend({},a,d);ha(a)},scrollToElement:function(a,b,e){W(a,b,e)},scrollTo:function(a,b,e){Y(a,e);M(b,e)},scrollToX:function(a,b){Y(a,b)},scrollToY:function(a,b){M(a,b)},scrollBy:function(a,b,e){n.scrollByX(a,e);n.scrollByY(b,e)},scrollByX:function(a,b){var e=(-h.position().left+a)/(D-m);V(e*G,b)},scrollByY:function(a,b){var e=(-h.position().top+a)/(w-l);O(e*B,b)},animate:function(a,b,e,g){var j={};j[b]=e;a.animate(j,{duration:d.animateDuration,ease:d.animateEase,
queue:false,step:g})},getContentPositionX:function(){return-h.position().left},getContentPositionY:function(){return-h.position().top},getIsScrollableH:function(){return x},getIsScrollableV:function(){return y},getContentPane:function(){return h},scrollToBottom:function(a){O(B,a)},hijackInternalLinks:function(){sa()}});ha(L)}I=c.extend({},c.fn.jScrollPane.defaults,I);c.each(["mouseWheelSpeed","arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){I[this]=I[this]||I.speed});var ga;this.each(function(){var f=
c(this),L=f.data("jsp");if(L)L.reinitialise(I);else{L=new Aa(f,I);f.data("jsp",L)}ga=ga?ga.add(f):f});return ga};c.fn.jScrollPane.defaults={showArrows:false,maintainPosition:true,clickOnTrack:true,autoReinitialise:false,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,animateScroll:false,animateDuration:300,animateEase:"linear",hijackInternalLinks:false,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:0,arrowButtonSpeed:0,
arrowRepeatFreq:50,arrowScrollOnHover:false,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:true,hideFocus:false,keyboardSpeed:0,keyboardRepeatFreq:50,initialDelay:300,speed:30,scrollPagePercent:0.8}})(jQuery,this);
