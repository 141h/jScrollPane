/*
 * jScrollPane - v2.0.0beta1 - 2010-08-05
 * http://jscrollpane.kelvinluck.com/
 *
 * Copyright (c) 2010 Kelvin Luck
 * Dual licensed under the MIT and GPL licenses.
 */
(function(b,a,c){b.fn.jScrollPane=function(f){function d(aa,Y){var af,g=this,X,F,O,ak,S,ae,W,B,o,ai,k,T,x,n,ah,A,M,Z,R,m,P,z,U,C,E,L,l,H,w,ag;F={};G(Y);function G(al){var ap,ao,an,am;af=al;if(X==c){aa.css("overflow","hidden");O=aa.innerWidth();ak=aa.innerHeight();X=b('<div class="jspPane" />').wrap(b('<div class="jspContainer" />').css({width:O+"px",height:ak+"px"}));aa.css("overflow","visible");aa.wrap(X.parent());X=aa.parent();S=X.parent();an=aa.find(":first-child");am=aa.find(":last-child");S.css({"margin-top":an.css("margin-top"),"margin-bottom":am.css("margin-bottom")});an.css("margin-top",0);am.css("margin-bottom",0)}else{O=S.outerWidth();ak=S.outerHeight();S.find(".jspVerticalBar,.jspHorizontalBar").remove().end()}aa.css({width:"auto",height:"auto"});ap=aa.clone().css("position","absolute");ao=b('<div style="width:1px; position: relative;" />').append(ap);b("body").append(ao);ae=Math.max(aa.outerWidth(),ap.outerWidth());ao.remove();W=aa.outerHeight();B=ae/O;o=W/ak;ai=o>1;k=B>1;if(!(k||ai)){aa.removeClass("jspScrollable");X.css("top",0);N();p();r()}else{aa.addClass("jspScrollable");v();ac();i();q();aj();if(af.hijackInternalLinks){h()}}}function v(){if(ai){S.append(b('<div class="jspVerticalBar" />').append(b('<div class="jspCap jspCapTop" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragTop" />'),b('<div class="jspDragBottom" />'))),b('<div class="jspCap jspCapBottom" />')));Z=S.find(">.jspVerticalBar");R=Z.find(">.jspTrack");T=R.find(">.jspDrag");if(af.showArrows){U=b('<a href="#" class="jspArrow jspArrowUp">Scroll up</a>').bind("mousedown.jsp",D(0,-1)).bind("click.jsp",ab);C=b('<a href="#" class="jspArrow jspArrowDown">Scroll down</a>').bind("mousedown.jsp",D(0,1)).bind("click.jsp",ab);R.before(U).after(C)}P=ak;S.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){P-=b(this).outerHeight()});T.hover(function(){T.addClass("jspHover")},function(){T.removeClass("jspHover")}).bind("mousedown.jsp",function(al){b("html").bind("dragstart.jsp selectstart.jsp",function(){return false});var s=al.pageY-T.position().top;b("html").bind("mousemove.jsp",function(am){I(am.pageY-s)}).bind("mouseup.jsp mouseleave.jsp",y);return false});K();j()}else{N()}}function K(){R.height(P+"px");n=0;m=af.verticalGutter+R.outerWidth();X.width(O-m);if(Z.position().left==0){X.css("margin-left",m+"px")}}function ac(){if(k){S.append(b('<div class="jspHorizontalBar" />').append(b('<div class="jspCap jspCapLeft" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragLeft" />'),b('<div class="jspDragRight" />'))),b('<div class="jspCap jspCapRight" />')));E=S.find(">.jspHorizontalBar");L=E.find(">.jspTrack");ah=L.find(">.jspDrag");if(af.showArrows){w=b('<a href="#" class="jspArrow jspArrowLeft">Scroll left</a>').bind("mousedown.jsp",D(-1,0)).bind("click.jsp",ab);ag=b('<a href="#" class="jspArrow jspArrowRight">Scroll right</a>').bind("mousedown.jsp",D(1,0)).bind("click.jsp",ab);L.before(w).after(ag)}ah.hover(function(){ah.addClass("jspHover")},function(){ah.removeClass("jspHover")}).bind("mousedown.jsp",function(al){b("html").bind("dragstart.jsp selectstart.jsp",function(){return false});var s=al.pageX-ah.position().left;b("html").bind("mousemove.jsp",function(am){J(am.pageX-s)}).bind("mouseup.jsp mouseleave.jsp",y);return false});l=S.innerWidth();V()}else{}}function V(){X.height(ak-af.horizontalGutter-L.outerHeight());S.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){l-=b(this).outerWidth()});L.width(l+"px");M=0}function i(){if(k&&ai){var al=L.outerHeight(),s=R.outerWidth();P-=al;b(E).find(">.jspCap:visible,>.jspArrow").each(function(){l+=b(this).outerWidth()});l-=s;ak-=s;O-=al;L.parent().append(b('<div class="jspCorner" />').css("width",al+"px"));
K();V()}if(k){X.width(S.outerWidth()+"px")}W=aa.outerHeight();o=W/ak;if(k){H=1/B*l;if(H>af.horizontalDragMaxWidth){H=af.horizontalDragMaxWidth}else{if(H<af.horizontalDragMinWidth){H=af.horizontalDragMinWidth}}ah.width(H+"px");A=l-H}if(ai){z=1/o*P;if(z>af.verticalDragMaxHeight){z=af.verticalDragMaxHeight}else{if(z<af.verticalDragMinHeight){z=af.verticalDragMinHeight}}T.height(z+"px");x=P-z}}function D(al,s){return function(){ad(al,s);this.blur();return false}}function ad(am,s){var al=setInterval(function(){if(am!=0){J(M+am*af.arrowButtonSpeed)}if(s!=0){I(n+s*af.arrowButtonSpeed)}},af.arrowRepeatFreq);b("html").bind("mouseup.jsp",function(){clearInterval(al);b("html").unbind("mouseup.jsp")})}function y(){b("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp")}function I(s){if(!ai){return}if(s<0){s=0}else{if(s>x){s=x}}n=s;T.css("top",s);S.scrollTop(0);var al=s/x;X.css("top",-al*(W-ak))}function J(s){if(!k){return}if(s<0){s=0}else{if(s>A){s=A}}M=s;ah.css("left",s);S.scrollTop(0);var al=s/A;X.css("left",-al*(ae-O))}function t(s){var al=s/(W-ak);I(al*x)}function u(s){var al=s/(ae-O);J(al*A)}function Q(at,aq){var ao,am,s=0,al,ap,ar;try{ao=b(at)}catch(an){return}am=ao.outerHeight();S.scrollTop(0);while(!ao.is(".jspPane")){s+=ao.position().top;ao=ao.offsetParent();if(/^body|html$/i.test(ao[0].nodeName)){return}}al=-X.position().top;ap=al+ak;if(s<al||aq){ar=s-af.verticalGutter}else{if(s+am>ap){ar=s-ak+am+af.verticalGutter}}if(ar){t(ar)}}function j(){S.bind("mousewheel.jsp",function(s,am){var al=n;I(n-am*af.mouseWheelSpeed);return al==n})}function N(){S.unbind("mousewheel.jsp")}function ab(){return false}function q(){aa.find(":input,a").bind("focus.jsp",function(){Q(this,false)})}function p(){aa.find(":input,a").unbind("focus.jsp")}function aj(){if(location.hash&&location.hash.length>1){var am,al;try{am=b(location.hash)}catch(s){return}if(am.length&&aa.find(am)){if(S.scrollTop()==0){al=setInterval(function(){if(S.scrollTop()>0){Q(location.hash,true);b(document).scrollTop(S.position().top);clearInterval(al)}},50)}else{Q(location.hash,true);b(document).scrollTop(S.position().top)}}}}function r(){b("a[href^=#]").unbind("click.jsp-hijack")}function h(){b("a[href^=#]").unbind("click.jsp-hijack").bind("click.jsp-hijack",function(){var s=this.href.split("#"),al;if(s.length>1){al=s[1];if(al.length>0&&aa.find("#"+al).length>0){Q("#"+al,true);return false}}})}b.extend(g,{reinitialise:function(s){G(s)},scrollToElement:function(al,s){Q(al,s)},scrollTo:function(al,s){u(al);t(s)},scrollToX:function(s){u(s)},scrollToY:function(s){t(s)},scrollBy:function(al,s){g.scrollByX(al);g.scrollByY(s)},scrollByX:function(s){var al=-X.position().left+s,am=al/(ae-O);J(am*A)},scrollByY:function(s){var al=-X.position().top+s,am=al/(W-ak);I(am*x)},scrollToBottom:function(){I(x)},hijackInternalLinks:function(){h()}})}f=b.extend({},b.fn.jScrollPane.defaults,f);var e;this.each(function(){var g=b(this),h=g.data("jsp");if(h){h.reinitialise(f)}else{h=new d(g,f);g.data("jsp",h)}e=e?e.add(g):g});return e};b.fn.jScrollPane.defaults={showArrows:false,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,hijackInternalLinks:false,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:10,arrowButtonSpeed:10,arrowRepeatFreq:100}})(jQuery,this);