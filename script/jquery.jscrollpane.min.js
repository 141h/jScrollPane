/*
 * jScrollPane - v2.0.0beta8 - 2011-01-29
 * http://jscrollpane.kelvinluck.com/
 *
 * Copyright (c) 2010 Kelvin Luck
 * Dual licensed under the MIT and GPL licenses.
 */
(function(b,a,c){b.fn.jScrollPane=function(f){function d(G,Q){var aA,S=this,aa,am,x,ao,V,ab,B,t,aB,aH,aw,k,L,j,l,ac,W,ar,Z,v,D,at,ah,ap,J,n,av,az,A,ax,aL,h,N,al=true,R=true,aK=false,m=false,E,i,ae=b.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";aL=G.css("paddingTop")+" "+G.css("paddingRight")+" "+G.css("paddingBottom")+" "+G.css("paddingLeft");h=(parseInt(G.css("paddingLeft"),10)||0)+(parseInt(G.css("paddingRight"),10)||0);function au(aO){var aS,aR,aQ,aN,aM,aP;aA=aO;if(aa===c){G.css({overflow:"hidden",padding:0});am=G.innerWidth()+h;x=G.innerHeight();G.width(am);aa=b('<div class="jspPane" />').css("padding",aL).append(G.children());ao=b('<div class="jspContainer" />').css({width:am+"px",height:x+"px"}).append(aa).appendTo(G)}else{G.css("width","");aP=G.innerWidth()+h!=am||G.outerHeight()!=x;if(aP){am=G.innerWidth()+h;x=G.innerHeight();ao.css({width:am+"px",height:x+"px"})}if(!aP&&N==V&&aa.outerHeight()==ab){G.width(am);return}N=V;aa.css("width","");G.width(am);ao.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}aS=aa.clone().css("position","absolute");aR=b('<div style="width:1px; position: relative;" />').append(aS);b("body").append(aR);V=Math.max(aa.outerWidth(),aS.outerWidth());aR.remove();ab=aa.outerHeight();B=V/am;t=ab/x;aB=t>1;aH=B>1;if(!(aH||aB)){G.removeClass("jspScrollable");aa.css({top:0,width:ao.width()-h});p();H();T();y();ak()}else{G.addClass("jspScrollable");aQ=aA.maintainPosition&&(L||ac);if(aQ){aN=aE();aM=aC()}aI();C();I();if(aQ){P(aN);O(aM)}M();ai();aq();if(aA.enableKeyboardNavigation){U()}if(aA.clickOnTrack){r()}F();if(aA.hijackInternalLinks){o()}}if(aA.autoReinitialise&&!ax){ax=setInterval(function(){au(aA)},aA.autoReinitialiseDelay)}else{if(!aA.autoReinitialise&&ax){clearInterval(ax)}}G.trigger("jsp-initialised",[aH||aB])}function aI(){if(aB){ao.append(b('<div class="jspVerticalBar" />').append(b('<div class="jspCap jspCapTop" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragTop" />'),b('<div class="jspDragBottom" />'))),b('<div class="jspCap jspCapBottom" />')));W=ao.find(">.jspVerticalBar");ar=W.find(">.jspTrack");aw=ar.find(">.jspDrag");if(aA.showArrows){at=b('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",aF(0,-1)).bind("click.jsp",aD);ah=b('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",aF(0,1)).bind("click.jsp",aD);if(aA.arrowScrollOnHover){at.bind("mouseover.jsp",aF(0,-1,at));ah.bind("mouseover.jsp",aF(0,1,ah))}an(ar,aA.verticalArrowPositions,at,ah)}v=x;ao.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){v-=b(this).outerHeight()});aw.hover(function(){aw.addClass("jspHover")},function(){aw.removeClass("jspHover")}).bind("mousedown.jsp",function(aM){b("html").bind("dragstart.jsp selectstart.jsp",aD);aw.addClass("jspActive");var s=aM.pageY-aw.position().top;b("html").bind("mousemove.jsp",function(aN){X(aN.pageY-s,false)}).bind("mouseup.jsp mouseleave.jsp",ay);return false});q()}}function q(){ar.height(v+"px");L=0;Z=aA.verticalGutter+ar.outerWidth();aa.width(am-Z-h);if(W.position().left===0){aa.css("margin-left",Z+"px")}}function C(){if(aH){ao.append(b('<div class="jspHorizontalBar" />').append(b('<div class="jspCap jspCapLeft" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragLeft" />'),b('<div class="jspDragRight" />'))),b('<div class="jspCap jspCapRight" />')));ap=ao.find(">.jspHorizontalBar");J=ap.find(">.jspTrack");j=J.find(">.jspDrag");if(aA.showArrows){az=b('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",aF(-1,0)).bind("click.jsp",aD);A=b('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",aF(1,0)).bind("click.jsp",aD);if(aA.arrowScrollOnHover){az.bind("mouseover.jsp",aF(-1,0,az));A.bind("mouseover.jsp",aF(1,0,A))}an(J,aA.horizontalArrowPositions,az,A)
}j.hover(function(){j.addClass("jspHover")},function(){j.removeClass("jspHover")}).bind("mousedown.jsp",function(aM){b("html").bind("dragstart.jsp selectstart.jsp",aD);j.addClass("jspActive");var s=aM.pageX-j.position().left;b("html").bind("mousemove.jsp",function(aN){Y(aN.pageX-s,false)}).bind("mouseup.jsp mouseleave.jsp",ay);return false});n=ao.innerWidth();aj()}}function aj(){ao.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){n-=b(this).outerWidth()});J.width(n+"px");ac=0}function I(){if(aH&&aB){var aM=J.outerHeight(),s=ar.outerWidth();v-=aM;b(ap).find(">.jspCap:visible,>.jspArrow").each(function(){n+=b(this).outerWidth()});n-=s;x-=s;am-=aM;J.parent().append(b('<div class="jspCorner" />').css("width",aM+"px"));q();aj()}if(aH){aa.width((ao.outerWidth()-h)+"px")}ab=aa.outerHeight();t=ab/x;if(aH){av=1/B*n;if(av>aA.horizontalDragMaxWidth){av=aA.horizontalDragMaxWidth}else{if(av<aA.horizontalDragMinWidth){av=aA.horizontalDragMinWidth}}j.width(av+"px");l=n-av;ag(ac)}if(aB){D=1/t*v;if(D>aA.verticalDragMaxHeight){D=aA.verticalDragMaxHeight}else{if(D<aA.verticalDragMinHeight){D=aA.verticalDragMinHeight}}aw.height(D+"px");k=v-D;af(L)}}function an(aN,aP,aM,s){var aR="before",aO="after",aQ;if(aP=="os"){aP=/Mac/.test(navigator.platform)?"after":"split"}if(aP==aR){aO=aP}else{if(aP==aO){aR=aP;aQ=aM;aM=s;s=aQ}}aN[aR](aM)[aO](s)}function aF(aM,s,aN){return function(){K(aM,s,this,aN);this.blur();return false}}function K(aP,aO,aS,aR){aS=b(aS).addClass("jspActive");var aQ,aN,aM=true,s=function(){if(aP!==0){S.scrollByX(aP*aA.arrowButtonSpeed)}if(aO!==0){S.scrollByY(aO*aA.arrowButtonSpeed)}aN=setTimeout(s,aM?aA.initialDelay:aA.arrowRepeatFreq);aM=false};s();aQ=aR?"mouseout.jsp":"mouseup.jsp";aR=aR||b("html");aR.bind(aQ,function(){aS.removeClass("jspActive");aN&&clearTimeout(aN);aN=null;aR.unbind(aQ);aJ()})}function r(){y();if(aB){ar.bind("mousedown.jsp",function(aR){if(aR.originalTarget===c||aR.originalTarget==aR.currentTarget){var aP=b(this),aS=aP.offset(),aQ=aR.pageY-aS.top-L,aN,aM=true,s=function(){var aV=aP.offset(),aW=aR.pageY-aV.top-D/2,aT=x*aA.scrollPagePercent,aU=k*aT/(ab-x);if(aQ<0){if(L-aU>aW){S.scrollByY(-aT)}else{X(aW)}}else{if(aQ>0){if(L+aU<aW){S.scrollByY(aT)}else{X(aW)}}else{aO();return}}aN=setTimeout(s,aM?aA.initialDelay:aA.trackClickRepeatFreq);aM=false},aO=function(){aN&&clearTimeout(aN);aN=null;b(document).unbind("mouseup.jsp",aO);aJ()};s();b(document).bind("mouseup.jsp",aO);return false}})}if(aH){J.bind("mousedown.jsp",function(aR){if(aR.originalTarget===c||aR.originalTarget==aR.currentTarget){var aP=b(this),aS=aP.offset(),aQ=aR.pageX-aS.left-ac,aN,aM=true,s=function(){var aV=aP.offset(),aW=aR.pageX-aV.left-av/2,aT=am*aA.scrollPagePercent,aU=l*aT/(V-am);if(aQ<0){if(ac-aU>aW){S.scrollByX(-aT)}else{Y(aW)}}else{if(aQ>0){if(ac+aU<aW){S.scrollByX(aT)}else{Y(aW)}}else{aO();return}}aN=setTimeout(s,aM?aA.initialDelay:aA.trackClickRepeatFreq);aM=false},aO=function(){aN&&clearTimeout(aN);aN=null;b(document).unbind("mouseup.jsp",aO);aJ()};s();b(document).bind("mouseup.jsp",aO);return false}})}}function y(){if(J){J.unbind("mousedown.jsp")}if(ar){ar.unbind("mousedown.jsp")}}function ay(){b("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp");if(aw){aw.removeClass("jspActive")}if(j){j.removeClass("jspActive")}aJ()}function X(s,aM){if(!aB){return}if(s<0){s=0}else{if(s>k){s=k}}if(aM===c){aM=aA.animateScroll}if(aM){S.animate(aw,"top",s,af)}else{aw.css("top",s);af(s)}}function af(aM){if(aM===c){aM=aw.position().top}ao.scrollTop(0);L=aM;var aP=L===0,aN=L==k,aO=aM/k,s=-aO*(ab-x);if(al!=aP||aK!=aN){al=aP;aK=aN;G.trigger("jsp-arrow-change",[al,aK,R,m])}w(aP,aN);aa.css("top",s);G.trigger("jsp-scroll-y",[-s,aP,aN])}function Y(aM,s){if(!aH){return}if(aM<0){aM=0}else{if(aM>l){aM=l}}if(s===c){s=aA.animateScroll}if(s){S.animate(j,"left",aM,ag)}else{j.css("left",aM);ag(aM)}}function ag(aM){if(aM===c){aM=j.position().left}ao.scrollTop(0);ac=aM;var aP=ac===0,aO=ac==l,aN=aM/l,s=-aN*(V-am);
if(R!=aP||m!=aO){R=aP;m=aO;G.trigger("jsp-arrow-change",[al,aK,R,m])}u(aP,aO);aa.css("left",s);G.trigger("jsp-scroll-x",[-s,aP,aO])}function w(aM,s){if(aA.showArrows){at[aM?"addClass":"removeClass"]("jspDisabled");ah[s?"addClass":"removeClass"]("jspDisabled")}}function u(aM,s){if(aA.showArrows){az[aM?"addClass":"removeClass"]("jspDisabled");A[s?"addClass":"removeClass"]("jspDisabled")}}function O(s,aM){var aN=s/(ab-x);X(aN*k,aM)}function P(aM,s){var aN=aM/(V-am);Y(aN*l,s)}function ad(aY,aT,aN){var aR,aO,aP,s=0,aX=0,aM,aS,aV,aU,aW;try{aR=b(aY)}catch(aQ){return}aO=aR.outerHeight();aP=aR.outerWidth();ao.scrollTop(0);ao.scrollLeft(0);while(!aR.is(".jspPane")){s+=aR.position().top;aX+=aR.position().left;aR=aR.offsetParent();if(/^body|html$/i.test(aR[0].nodeName)){return}}aM=aC();aS=aM+x;if(s<aM||aT){aU=s-aA.verticalGutter}else{if(s+aO>aS){aU=s-x+aO+aA.verticalGutter}}if(aU){O(aU,aN)}viewportLeft=aE();aV=viewportLeft+am;if(aX<viewportLeft||aT){aW=aX-aA.horizontalGutter}else{if(aX+aP>aV){aW=aX-am+aP+aA.horizontalGutter}}if(aW){P(aW,aN)}}function aE(){return -aa.position().left}function aC(){return -aa.position().top}function ai(){ao.unbind(ae).bind(ae,function(aP,aQ,aO,aM){var aN=ac,s=L;S.scrollBy(aO*aA.mouseWheelSpeed,-aM*aA.mouseWheelSpeed,false);return aN==ac&&s==L})}function p(){ao.unbind(ae)}function aD(){return false}function M(){aa.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(s){ad(s.target,false)})}function H(){aa.find(":input,a").unbind("focus.jsp")}function z(){var aM=ac,s=L;switch(E){case 40:S.scrollByY(aA.keyboardSpeed,false);break;case 38:S.scrollByY(-aA.keyboardSpeed,false);break;case 34:case 32:S.scrollByY(x*aA.scrollPagePercent,false);break;case 33:S.scrollByY(-x*aA.scrollPagePercent,false);break;case 39:S.scrollByX(aA.keyboardSpeed,false);break;case 37:S.scrollByX(-aA.keyboardSpeed,false);break}return aM!=ac||s!=L}function g(s){i=setTimeout(function(){g()},s?aA.initialDelay:aA.keyboardRepeatFreq);if(!z()){aG()}}function aG(){E=null;if(i){clearTimeout(i);i=null}}function U(){aa.focus(function(){G.focus()});G.attr("tabindex",0).unbind("keydown.jsp keyup.jsp").bind("keydown.jsp",function(aN){if(aN.target!==this){return}var aM=ac,s=L;switch(aN.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:if(E!=aN.keyCode){aG();E=aN.keyCode;g(true)}break;case 35:O(ab-x);E=null;break;case 36:O(0);E=null;break}if(E==aN.keyCode||aM!=ac||s!=L){return false}}).bind("keyup.jsp",function(s){aG()});if(aA.hideFocus){G.css("outline","none");if("hideFocus" in ao[0]){G.attr("hideFocus",true)}}else{G.css("outline","");if("hideFocus" in ao[0]){G.attr("hideFocus",false)}}}function T(){G.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keyup.jsp")}function F(){if(location.hash&&location.hash.length>1){var aN,aM;try{aN=b(location.hash)}catch(s){return}if(aN.length&&aa.find(location.hash)){if(ao.scrollTop()===0){aM=setInterval(function(){if(ao.scrollTop()>0){ad(location.hash,true);b(document).scrollTop(ao.position().top);clearInterval(aM)}},50)}else{ad(location.hash,true);b(document).scrollTop(ao.position().top)}}}}function ak(){b("a.jspHijack").unbind("click.jsp-hijack").removeClass("jspHijack")}function o(){ak();b("a[href^=#]").addClass("jspHijack").bind("click.jsp-hijack",function(){var s=this.href.split("#"),aM;if(s.length>1){aM=s[1];if(aM.length>0&&aa.find("#"+aM).length>0){ad("#"+aM,true);return false}}})}function aJ(){if(!b(":focus").length){G.focus()}}function aq(){var aN,aM,aP,aO,aQ,s=false;ao.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(aR){var aS=aR.originalEvent.touches[0];aN=aE();aM=aC();aP=aS.pageX;aO=aS.pageY;aQ=false;s=true}).bind("touchmove.jsp",function(aU){if(!s){return}var aT=aU.originalEvent.touches[0],aS=ac,aR=L;S.scrollTo(aN+aP-aT.pageX,aM+aO-aT.pageY);aQ=aQ||Math.abs(aP-aT.pageX)>5||Math.abs(aO-aT.pageY)>5;return aS==ac&&aR==L}).bind("touchend.jsp",function(aR){s=false}).bind("click.jsp-touchclick",function(aR){if(aQ){aQ=false;
return false}})}b.extend(S,{reinitialise:function(aM){aM=b.extend({},aA,aM);au(aM)},scrollToElement:function(aN,aM,s){ad(aN,aM,s)},scrollTo:function(aN,s,aM){P(aN,aM);O(s,aM)},scrollToX:function(aM,s){P(aM,s)},scrollToY:function(s,aM){O(s,aM)},scrollBy:function(aM,s,aN){S.scrollByX(aM,aN);S.scrollByY(s,aN)},scrollByX:function(s,aN){var aM=aE()+s,aO=aM/(V-am);Y(aO*l,aN)},scrollByY:function(s,aN){var aM=aC()+s,aO=aM/(ab-x);X(aO*k,aN)},animate:function(aM,aP,s,aO){var aN={};aN[aP]=s;aM.animate(aN,{duration:aA.animateDuration,ease:aA.animateEase,queue:false,step:aO})},getContentPositionX:function(){return aE()},getContentPositionY:function(){return aC()},getIsScrollableH:function(){return aH},getIsScrollableV:function(){return aB},getContentPane:function(){return aa},scrollToBottom:function(s){X(k,s)},hijackInternalLinks:function(){o()}});au(Q)}f=b.extend({},b.fn.jScrollPane.defaults,f);b.each(["mouseWheelSpeed","arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){f[this]=f[this]||f.speed});var e;this.each(function(){var g=b(this),h=g.data("jsp");if(h){h.reinitialise(f)}else{h=new d(g,f);g.data("jsp",h)}e=e?e.add(g):g});return e};b.fn.jScrollPane.defaults={showArrows:false,maintainPosition:true,clickOnTrack:true,autoReinitialise:false,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,animateScroll:false,animateDuration:300,animateEase:"linear",hijackInternalLinks:false,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:0,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:false,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:true,hideFocus:false,keyboardSpeed:0,keyboardRepeatFreq:50,initialDelay:300,speed:30,scrollPagePercent:0.8}})(jQuery,this);