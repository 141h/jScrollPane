/*
 * jScrollPane - v2.0.0beta1 - 2010-08-05
 * http://jscrollpane.kelvinluck.com/
 *
 * Copyright (c) 2010 Kelvin Luck
 * Dual licensed under the MIT and GPL licenses.
 */
(function(b,a,c){b.fn.jScrollPane=function(f){function d(Y,ad){var g=this,W,E,N,ah,R,ac,V,A,o,ag,k,S,w,n,af,z,L,X,Q,m,O,y,T,B,D,K,l,G,v,ae;E={};F(ad);function F(ai){var am,al,ak,aj;if(W==c){Y.css("overflow","hidden");N=Y.innerWidth();ah=Y.innerHeight();W=b('<div class="jspPane" />').wrap(b('<div class="jspContainer" />').css({width:N+"px",height:ah+"px"}));Y.css("overflow","visible");Y.wrap(W.parent());W=Y.parent();R=W.parent();ak=Y.find(":first-child");aj=Y.find(":last-child");R.css({"margin-top":ak.css("margin-top"),"margin-bottom":aj.css("margin-bottom")});ak.css("margin-top",0);aj.css("margin-bottom",0)}else{N=R.outerWidth();ah=R.outerHeight();R.find(".jspVerticalBar,.jspHorizontalBar").remove().end()}Y.css({width:"auto",height:"auto"});am=Y.clone().css("position","absolute");al=b('<div style="width:1px; position: relative;" />').append(am);b("body").append(al);ac=Math.max(Y.outerWidth(),am.outerWidth());al.remove();V=Y.outerHeight();A=ac/N;o=V/ah;ag=o>1;k=A>1;if(!(k||ag)){Y.removeClass("jspScrollable");W.css("top",0);M();p();r()}else{Y.addClass("jspScrollable");u();aa();i();q();if(ai.hijackInternalLinks){h()}}}function u(){if(ag){R.append(b('<div class="jspVerticalBar" />').append(b('<div class="jspCap jspCapTop" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragTop" />'),b('<div class="jspDragBottom" />'))),b('<div class="jspCap jspCapBottom" />')));X=R.find(">.jspVerticalBar");Q=X.find(">.jspTrack");S=Q.find(">.jspDrag");if(ad.showArrows){T=b('<a href="#" class="jspArrow jspArrowUp">Scroll up</a>').bind("mousedown.jsp",C(0,-1)).bind("click.jsp",Z);B=b('<a href="#" class="jspArrow jspArrowDown">Scroll down</a>').bind("mousedown.jsp",C(0,1)).bind("click.jsp",Z);Q.before(T).after(B)}O=ah;R.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){O-=b(this).outerHeight()});S.hover(function(){S.addClass("jspHover")},function(){S.removeClass("jspHover")}).bind("mousedown.jsp",function(aj){b("html").bind("dragstart.jsp selectstart.jsp",function(){return false});var ai=aj.pageY-S.position().top;b("html").bind("mousemove.jsp",function(ak){H(ak.pageY-ai)}).bind("mouseup.jsp mouseleave.jsp",x);return false});J();j()}else{M()}}function J(){Q.height(O+"px");n=0;m=ad.verticalGutter+Q.outerWidth();W.width(N-m);if(X.position().left==0){W.css("margin-left",m+"px")}}function aa(){if(k){R.append(b('<div class="jspHorizontalBar" />').append(b('<div class="jspCap jspCapLeft" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragLeft" />'),b('<div class="jspDragRight" />'))),b('<div class="jspCap jspCapRight" />')));D=R.find(">.jspHorizontalBar");K=D.find(">.jspTrack");af=K.find(">.jspDrag");if(ad.showArrows){v=b('<a href="#" class="jspArrow jspArrowLeft">Scroll left</a>').bind("mousedown.jsp",C(-1,0)).bind("click.jsp",Z);ae=b('<a href="#" class="jspArrow jspArrowRight">Scroll right</a>').bind("mousedown.jsp",C(1,0)).bind("click.jsp",Z);K.before(v).after(ae)}af.hover(function(){af.addClass("jspHover")},function(){af.removeClass("jspHover")}).bind("mousedown.jsp",function(aj){b("html").bind("dragstart.jsp selectstart.jsp",function(){return false});var ai=aj.pageX-af.position().left;b("html").bind("mousemove.jsp",function(ak){I(ak.pageX-ai)}).bind("mouseup.jsp mouseleave.jsp",x);return false});l=R.innerWidth();U()}else{}}function U(){W.height(ah-ad.horizontalGutter-K.outerHeight());R.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){l-=b(this).outerWidth()});K.width(l+"px");L=0}function i(){if(k&&ag){var aj=K.outerHeight(),ai=Q.outerWidth();O-=aj;b(D).find(">.jspCap:visible,>.jspArrow").each(function(){l+=b(this).outerWidth()});l-=ai;ah-=ai;N-=aj;K.parent().append(b('<div class="jspCorner" />').css("width",aj+"px"));
J();U()}if(k){W.width(R.outerWidth()+"px")}V=Y.outerHeight();o=V/ah;if(k){G=1/A*l;if(G>ad.horizontalDragMaxWidth){G=ad.horizontalDragMaxWidth}else{if(G<ad.horizontalDragMinWidth){G=ad.horizontalDragMinWidth}}af.width(G+"px");z=l-G}if(ag){y=1/o*O;if(y>ad.verticalDragMaxHeight){y=ad.verticalDragMaxHeight}else{if(y<ad.verticalDragMinHeight){y=ad.verticalDragMinHeight}}S.height(y+"px");w=O-y}}function C(aj,ai){return function(){ab(aj,ai);this.blur();return false}}function ab(ak,ai){var aj=setInterval(function(){if(ak!=0){I(L+ak*ad.arrowButtonSpeed)}if(ai!=0){H(n+ai*ad.arrowButtonSpeed)}},ad.arrowRepeatFreq);b("html").bind("mouseup.jsp",function(){clearInterval(aj);b("html").unbind("mouseup.jsp")})}function x(){b("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp")}function H(ai){if(ai<0){ai=0}else{if(ai>w){ai=w}}n=ai;S.css("top",ai);R.scrollTop(0);var aj=ai/w;W.css("top",-aj*(V-ah))}function I(ai){if(ai<0){ai=0}else{if(ai>z){ai=z}}L=ai;af.css("left",ai);R.scrollTop(0);var aj=ai/z;W.css("left",-aj*(ac-N))}function s(ai){var aj=ai/(V-ah);H(aj*w)}function t(ai){var aj=ai/(ac-N);I(aj*z)}function P(ak){var an=b(ak),ao=an.outerHeight(),am=0,ai,al,aj;while(!an.is(".jspPane")){am+=an.position().top;an=an.offsetParent();if(/^body|html$/i.test(an[0].nodeName)){return}}R.scrollTop(0);ai=-W.position().top;al=ai+ah;if(am<ai){aj=am-ad.verticalGutter}else{if(am+ao>al){aj=am-ah+ao+ad.verticalGutter}}if(aj){s(aj)}}function j(){R.bind("mousewheel.jsp",function(ai,ak){var aj=n;H(n-ak*ad.mouseWheelSpeed);return aj==n})}function M(){R.unbind("mousewheel.jsp")}function Z(){return false}function q(){Y.find(":input,a").bind("focus.jsp",function(){P(this)})}function p(){Y.find(":input,a").unbind("focus.jsp")}function r(){b("a[href^=#]").unbind("click.jsp-hijack")}function h(){b("a[href^=#]").unbind("click.jsp-hijack").bind("click.jsp-hijack",function(){var ai=this.href.split("#"),aj;if(ai.length>1){aj=ai[1];if(aj.length>0&&Y.find("#"+aj).length>0){P("#"+aj);return false}}})}b.extend(g,{reinitialise:function(ai){F(ai)},scrollToElement:function(ai){P(ai)},scrollToY:function(ai){s(ai)},scrollToX:function(ai){t(ai)},scrollToBottom:function(){H(w)},hijackInternalLinks:function(){h()}})}f=b.extend({},b.fn.jScrollPane.defaults,f);var e;this.each(function(){var g=b(this),h=g.data("jsp");if(h){h.reinitialise(f)}else{h=new d(g,f);g.data("jsp",h)}e=e?e.add(g):g});return e};b.fn.jScrollPane.defaults={showArrows:false,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,hijackInternalLinks:false,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:10,arrowButtonSpeed:10,arrowRepeatFreq:100}})(jQuery,this);