/*
 * jScrollPane - v2.0.0beta1 - 2010-08-05
 * http://jscrollpane.kelvinluck.com/
 *
 * Copyright (c) 2010 Kelvin Luck
 * Dual licensed under the MIT and GPL licenses.
 */
(function(b,a,c){b.fn.jScrollPane=function(f){function d(Y,ad){var g=this,W,E,N,ai,R,ac,V,A,o,ag,k,S,w,n,af,z,L,X,Q,m,O,y,T,B,D,K,l,G,v,ae;E={};F(ad);function F(aj){var an,am,al,ak;if(W==c){Y.css("overflow","hidden");N=Y.innerWidth();ai=Y.innerHeight();W=b('<div class="jspPane" />').wrap(b('<div class="jspContainer" />').css({width:N+"px",height:ai+"px"}));Y.css("overflow","visible");Y.wrap(W.parent());W=Y.parent();R=W.parent();al=Y.find(":first-child");ak=Y.find(":last-child");R.css({"margin-top":al.css("margin-top"),"margin-bottom":ak.css("margin-bottom")});al.css("margin-top",0);ak.css("margin-bottom",0)}else{N=R.outerWidth();ai=R.outerHeight();R.find(".jspVerticalBar,.jspHorizontalBar").remove().end()}Y.css({width:"auto",height:"auto"});an=Y.clone().css("position","absolute");am=b('<div style="width:1px; position: relative;" />').append(an);b("body").append(am);ac=Math.max(Y.outerWidth(),an.outerWidth());am.remove();V=Y.outerHeight();A=ac/N;o=V/ai;ag=o>1;k=A>1;if(!(k||ag)){Y.removeClass("jspScrollable");W.css("top",0);M();p();r()}else{Y.addClass("jspScrollable");u();aa();i();q();ah();if(aj.hijackInternalLinks){h()}}}function u(){if(ag){R.append(b('<div class="jspVerticalBar" />').append(b('<div class="jspCap jspCapTop" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragTop" />'),b('<div class="jspDragBottom" />'))),b('<div class="jspCap jspCapBottom" />')));X=R.find(">.jspVerticalBar");Q=X.find(">.jspTrack");S=Q.find(">.jspDrag");if(ad.showArrows){T=b('<a href="#" class="jspArrow jspArrowUp">Scroll up</a>').bind("mousedown.jsp",C(0,-1)).bind("click.jsp",Z);B=b('<a href="#" class="jspArrow jspArrowDown">Scroll down</a>').bind("mousedown.jsp",C(0,1)).bind("click.jsp",Z);Q.before(T).after(B)}O=ai;R.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){O-=b(this).outerHeight()});S.hover(function(){S.addClass("jspHover")},function(){S.removeClass("jspHover")}).bind("mousedown.jsp",function(ak){b("html").bind("dragstart.jsp selectstart.jsp",function(){return false});var aj=ak.pageY-S.position().top;b("html").bind("mousemove.jsp",function(al){H(al.pageY-aj)}).bind("mouseup.jsp mouseleave.jsp",x);return false});J();j()}else{M()}}function J(){Q.height(O+"px");n=0;m=ad.verticalGutter+Q.outerWidth();W.width(N-m);if(X.position().left==0){W.css("margin-left",m+"px")}}function aa(){if(k){R.append(b('<div class="jspHorizontalBar" />').append(b('<div class="jspCap jspCapLeft" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragLeft" />'),b('<div class="jspDragRight" />'))),b('<div class="jspCap jspCapRight" />')));D=R.find(">.jspHorizontalBar");K=D.find(">.jspTrack");af=K.find(">.jspDrag");if(ad.showArrows){v=b('<a href="#" class="jspArrow jspArrowLeft">Scroll left</a>').bind("mousedown.jsp",C(-1,0)).bind("click.jsp",Z);ae=b('<a href="#" class="jspArrow jspArrowRight">Scroll right</a>').bind("mousedown.jsp",C(1,0)).bind("click.jsp",Z);K.before(v).after(ae)}af.hover(function(){af.addClass("jspHover")},function(){af.removeClass("jspHover")}).bind("mousedown.jsp",function(ak){b("html").bind("dragstart.jsp selectstart.jsp",function(){return false});var aj=ak.pageX-af.position().left;b("html").bind("mousemove.jsp",function(al){I(al.pageX-aj)}).bind("mouseup.jsp mouseleave.jsp",x);return false});l=R.innerWidth();U()}else{}}function U(){W.height(ai-ad.horizontalGutter-K.outerHeight());R.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){l-=b(this).outerWidth()});K.width(l+"px");L=0}function i(){if(k&&ag){var ak=K.outerHeight(),aj=Q.outerWidth();O-=ak;b(D).find(">.jspCap:visible,>.jspArrow").each(function(){l+=b(this).outerWidth()});l-=aj;ai-=aj;N-=ak;K.parent().append(b('<div class="jspCorner" />').css("width",ak+"px"));
J();U()}if(k){W.width(R.outerWidth()+"px")}V=Y.outerHeight();o=V/ai;if(k){G=1/A*l;if(G>ad.horizontalDragMaxWidth){G=ad.horizontalDragMaxWidth}else{if(G<ad.horizontalDragMinWidth){G=ad.horizontalDragMinWidth}}af.width(G+"px");z=l-G}if(ag){y=1/o*O;if(y>ad.verticalDragMaxHeight){y=ad.verticalDragMaxHeight}else{if(y<ad.verticalDragMinHeight){y=ad.verticalDragMinHeight}}S.height(y+"px");w=O-y}}function C(ak,aj){return function(){ab(ak,aj);this.blur();return false}}function ab(al,aj){var ak=setInterval(function(){if(al!=0){I(L+al*ad.arrowButtonSpeed)}if(aj!=0){H(n+aj*ad.arrowButtonSpeed)}},ad.arrowRepeatFreq);b("html").bind("mouseup.jsp",function(){clearInterval(ak);b("html").unbind("mouseup.jsp")})}function x(){b("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp")}function H(aj){if(!ag){return}if(aj<0){aj=0}else{if(aj>w){aj=w}}n=aj;S.css("top",aj);R.scrollTop(0);var ak=aj/w;W.css("top",-ak*(V-ai))}function I(aj){if(!k){return}if(aj<0){aj=0}else{if(aj>z){aj=z}}L=aj;af.css("left",aj);R.scrollTop(0);var ak=aj/z;W.css("left",-ak*(ac-N))}function s(aj){var ak=aj/(V-ai);H(ak*w)}function t(aj){var ak=aj/(ac-N);I(ak*z)}function P(ar,ap){var an,al,aj=0,ak,ao,aq;try{an=b(ar)}catch(am){return}al=an.outerHeight();R.scrollTop(0);while(!an.is(".jspPane")){aj+=an.position().top;an=an.offsetParent();if(/^body|html$/i.test(an[0].nodeName)){return}}ak=-W.position().top;ao=ak+ai;if(aj<ak||ap){aq=aj-ad.verticalGutter}else{if(aj+al>ao){aq=aj-ai+al+ad.verticalGutter}}if(aq){s(aq)}}function j(){R.bind("mousewheel.jsp",function(aj,al){var ak=n;H(n-al*ad.mouseWheelSpeed);return ak==n})}function M(){R.unbind("mousewheel.jsp")}function Z(){return false}function q(){Y.find(":input,a").bind("focus.jsp",function(){P(this,false)})}function p(){Y.find(":input,a").unbind("focus.jsp")}function ah(){if(location.hash&&location.hash.length>1){var al,ak;try{al=b(location.hash)}catch(aj){return}if(al.length&&Y.find(al)){if(R.scrollTop()==0){ak=setInterval(function(){if(R.scrollTop()>0){P(location.hash,true);b(document).scrollTop(R.position().top);clearInterval(ak)}},50)}else{P(location.hash,true);b(document).scrollTop(R.position().top)}}}}function r(){b("a[href^=#]").unbind("click.jsp-hijack")}function h(){b("a[href^=#]").unbind("click.jsp-hijack").bind("click.jsp-hijack",function(){var aj=this.href.split("#"),ak;if(aj.length>1){ak=aj[1];if(ak.length>0&&Y.find("#"+ak).length>0){P("#"+ak,true);return false}}})}b.extend(g,{reinitialise:function(aj){F(aj)},scrollToElement:function(ak,aj){P(ak,aj)},scrollTo:function(ak,aj){t(ak);s(aj)},scrollToX:function(aj){t(aj)},scrollToY:function(aj){s(aj)},scrollBy:function(ak,aj){g.scrollByX(ak);g.scrollByY(aj)},scrollByX:function(aj){var ak=-W.position().left+aj,al=ak/(ac-N);I(al*z)},scrollByY:function(aj){var ak=-W.position().top+aj,al=ak/(V-ai);H(al*w)},scrollToBottom:function(){H(w)},hijackInternalLinks:function(){h()}})}f=b.extend({},b.fn.jScrollPane.defaults,f);var e;this.each(function(){var g=b(this),h=g.data("jsp");if(h){h.reinitialise(f)}else{h=new d(g,f);g.data("jsp",h)}e=e?e.add(g):g});return e};b.fn.jScrollPane.defaults={showArrows:false,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,hijackInternalLinks:false,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:10,arrowButtonSpeed:10,arrowRepeatFreq:100}})(jQuery,this);