/*
 * jScrollPane - v2.0.0beta9 - 2011-01-29
 * http://jscrollpane.kelvinluck.com/
 *
 * Copyright (c) 2010 Kelvin Luck
 * Dual licensed under the MIT and GPL licenses.
 */
(function(b,a,c){b.fn.jScrollPane=function(f){function d(G,Q){var aB,S=this,aa,am,x,ao,V,ab,B,t,aC,aI,ax,k,L,j,l,ac,W,ar,Z,v,D,at,ah,ap,J,n,av,aA,A,ay,aM,h,N,al=true,R=true,aL=false,m=false,E,aw,ae=b.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";aM=G.css("paddingTop")+" "+G.css("paddingRight")+" "+G.css("paddingBottom")+" "+G.css("paddingLeft");h=(parseInt(G.css("paddingLeft"),10)||0)+(parseInt(G.css("paddingRight"),10)||0);function au(aP){var aT,aS,aR,aO,aN,aQ;aB=aP;if(aa===c){G.css({overflow:"hidden",padding:0});am=G.innerWidth()+h;x=G.innerHeight();G.width(am);aa=b('<div class="jspPane" />').css("padding",aM).append(G.children());ao=b('<div class="jspContainer" />').css({width:am+"px",height:x+"px"}).append(aa).appendTo(G)}else{G.css("width","");aQ=G.innerWidth()+h!=am||G.outerHeight()!=x;if(aQ){am=G.innerWidth()+h;x=G.innerHeight();ao.css({width:am+"px",height:x+"px"})}if(!aQ&&N==V&&aa.outerHeight()==ab){G.width(am);return}N=V;aa.css("width","");G.width(am);ao.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}aT=aa.clone().css("position","absolute");aS=b('<div style="width:1px; position: relative;" />').append(aT);b("body").append(aS);V=Math.max(aa.outerWidth(),aT.outerWidth());aS.remove();ab=aa.outerHeight();B=V/am;t=ab/x;aC=t>1;aI=B>1;if(!(aI||aC)){G.removeClass("jspScrollable");aa.css({top:0,width:ao.width()-h});p();H();T();y();ak()}else{G.addClass("jspScrollable");aR=aB.maintainPosition&&(L||ac);if(aR){aO=aF();aN=aD()}aJ();C();I();if(aR){P(aO);O(aN)}M();ai();aq();if(aB.enableKeyboardNavigation){U()}if(aB.clickOnTrack){r()}F();if(aB.hijackInternalLinks){o()}}if(aB.autoReinitialise&&!ay){ay=setInterval(function(){au(aB)},aB.autoReinitialiseDelay)}else{if(!aB.autoReinitialise&&ay){clearInterval(ay)}}G.trigger("jsp-initialised",[aI||aC])}function aJ(){if(aC){ao.append(b('<div class="jspVerticalBar" />').append(b('<div class="jspCap jspCapTop" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragTop" />'),b('<div class="jspDragBottom" />'))),b('<div class="jspCap jspCapBottom" />')));W=ao.find(">.jspVerticalBar");ar=W.find(">.jspTrack");ax=ar.find(">.jspDrag");if(aB.showArrows){at=b('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",aG(0,-1)).bind("click.jsp",aE);ah=b('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",aG(0,1)).bind("click.jsp",aE);if(aB.arrowScrollOnHover){at.bind("mouseover.jsp",aG(0,-1,at));ah.bind("mouseover.jsp",aG(0,1,ah))}an(ar,aB.verticalArrowPositions,at,ah)}v=x;ao.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){v-=b(this).outerHeight()});ax.hover(function(){ax.addClass("jspHover")},function(){ax.removeClass("jspHover")}).bind("mousedown.jsp",function(aN){b("html").bind("dragstart.jsp selectstart.jsp",aE);ax.addClass("jspActive");var s=aN.pageY-ax.position().top;b("html").bind("mousemove.jsp",function(aO){X(aO.pageY-s,false)}).bind("mouseup.jsp mouseleave.jsp",az);return false});q()}}function q(){ar.height(v+"px");L=0;Z=aB.verticalGutter+ar.outerWidth();aa.width(am-Z-h);if(W.position().left===0){aa.css("margin-left",Z+"px")}}function C(){if(aI){ao.append(b('<div class="jspHorizontalBar" />').append(b('<div class="jspCap jspCapLeft" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragLeft" />'),b('<div class="jspDragRight" />'))),b('<div class="jspCap jspCapRight" />')));ap=ao.find(">.jspHorizontalBar");J=ap.find(">.jspTrack");j=J.find(">.jspDrag");if(aB.showArrows){aA=b('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",aG(-1,0)).bind("click.jsp",aE);A=b('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",aG(1,0)).bind("click.jsp",aE);if(aB.arrowScrollOnHover){aA.bind("mouseover.jsp",aG(-1,0,aA));A.bind("mouseover.jsp",aG(1,0,A))}an(J,aB.horizontalArrowPositions,aA,A)
}j.hover(function(){j.addClass("jspHover")},function(){j.removeClass("jspHover")}).bind("mousedown.jsp",function(aN){b("html").bind("dragstart.jsp selectstart.jsp",aE);j.addClass("jspActive");var s=aN.pageX-j.position().left;b("html").bind("mousemove.jsp",function(aO){Y(aO.pageX-s,false)}).bind("mouseup.jsp mouseleave.jsp",az);return false});n=ao.innerWidth();aj()}}function aj(){ao.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){n-=b(this).outerWidth()});J.width(n+"px");ac=0}function I(){if(aI&&aC){var aN=J.outerHeight(),s=ar.outerWidth();v-=aN;b(ap).find(">.jspCap:visible,>.jspArrow").each(function(){n+=b(this).outerWidth()});n-=s;x-=s;am-=aN;J.parent().append(b('<div class="jspCorner" />').css("width",aN+"px"));q();aj()}if(aI){aa.width((ao.outerWidth()-h)+"px")}ab=aa.outerHeight();t=ab/x;if(aI){av=1/B*n;if(av>aB.horizontalDragMaxWidth){av=aB.horizontalDragMaxWidth}else{if(av<aB.horizontalDragMinWidth){av=aB.horizontalDragMinWidth}}j.width(av+"px");l=n-av;ag(ac)}if(aC){D=1/t*v;if(D>aB.verticalDragMaxHeight){D=aB.verticalDragMaxHeight}else{if(D<aB.verticalDragMinHeight){D=aB.verticalDragMinHeight}}ax.height(D+"px");k=v-D;af(L)}}function an(aO,aQ,aN,s){var aS="before",aP="after",aR;if(aQ=="os"){aQ=/Mac/.test(navigator.platform)?"after":"split"}if(aQ==aS){aP=aQ}else{if(aQ==aP){aS=aQ;aR=aN;aN=s;s=aR}}aO[aS](aN)[aP](s)}function aG(aN,s,aO){return function(){K(aN,s,this,aO);this.blur();return false}}function K(aQ,aP,aT,aS){aT=b(aT).addClass("jspActive");var aR,aO,aN=true,s=function(){if(aQ!==0){S.scrollByX(aQ*aB.arrowButtonSpeed)}if(aP!==0){S.scrollByY(aP*aB.arrowButtonSpeed)}aO=setTimeout(s,aN?aB.initialDelay:aB.arrowRepeatFreq);aN=false};s();aR=aS?"mouseout.jsp":"mouseup.jsp";aS=aS||b("html");aS.bind(aR,function(){aT.removeClass("jspActive");aO&&clearTimeout(aO);aO=null;aS.unbind(aR);aK()})}function r(){y();if(aC){ar.bind("mousedown.jsp",function(aS){if(aS.originalTarget===c||aS.originalTarget==aS.currentTarget){var aQ=b(this),aT=aQ.offset(),aR=aS.pageY-aT.top-L,aO,aN=true,s=function(){var aW=aQ.offset(),aX=aS.pageY-aW.top-D/2,aU=x*aB.scrollPagePercent,aV=k*aU/(ab-x);if(aR<0){if(L-aV>aX){S.scrollByY(-aU)}else{X(aX)}}else{if(aR>0){if(L+aV<aX){S.scrollByY(aU)}else{X(aX)}}else{aP();return}}aO=setTimeout(s,aN?aB.initialDelay:aB.trackClickRepeatFreq);aN=false},aP=function(){aO&&clearTimeout(aO);aO=null;b(document).unbind("mouseup.jsp",aP);aK()};s();b(document).bind("mouseup.jsp",aP);return false}})}if(aI){J.bind("mousedown.jsp",function(aS){if(aS.originalTarget===c||aS.originalTarget==aS.currentTarget){var aQ=b(this),aT=aQ.offset(),aR=aS.pageX-aT.left-ac,aO,aN=true,s=function(){var aW=aQ.offset(),aX=aS.pageX-aW.left-av/2,aU=am*aB.scrollPagePercent,aV=l*aU/(V-am);if(aR<0){if(ac-aV>aX){S.scrollByX(-aU)}else{Y(aX)}}else{if(aR>0){if(ac+aV<aX){S.scrollByX(aU)}else{Y(aX)}}else{aP();return}}aO=setTimeout(s,aN?aB.initialDelay:aB.trackClickRepeatFreq);aN=false},aP=function(){aO&&clearTimeout(aO);aO=null;b(document).unbind("mouseup.jsp",aP);aK()};s();b(document).bind("mouseup.jsp",aP);return false}})}}function y(){if(J){J.unbind("mousedown.jsp")}if(ar){ar.unbind("mousedown.jsp")}}function az(){b("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp");if(ax){ax.removeClass("jspActive")}if(j){j.removeClass("jspActive")}aK()}function X(s,aN){if(!aC){return}if(s<0){s=0}else{if(s>k){s=k}}if(aN===c){aN=aB.animateScroll}if(aN){S.animate(ax,"top",s,af)}else{ax.css("top",s);af(s)}}function af(aN){if(aN===c){aN=ax.position().top}ao.scrollTop(0);L=aN;var aQ=L===0,aO=L==k,aP=aN/k,s=-aP*(ab-x);if(al!=aQ||aL!=aO){al=aQ;aL=aO;G.trigger("jsp-arrow-change",[al,aL,R,m])}w(aQ,aO);aa.css("top",s);G.trigger("jsp-scroll-y",[-s,aQ,aO])}function Y(aN,s){if(!aI){return}if(aN<0){aN=0}else{if(aN>l){aN=l}}if(s===c){s=aB.animateScroll}if(s){S.animate(j,"left",aN,ag)}else{j.css("left",aN);ag(aN)}}function ag(aN){if(aN===c){aN=j.position().left}ao.scrollTop(0);ac=aN;var aQ=ac===0,aP=ac==l,aO=aN/l,s=-aO*(V-am);
if(R!=aQ||m!=aP){R=aQ;m=aP;G.trigger("jsp-arrow-change",[al,aL,R,m])}u(aQ,aP);aa.css("left",s);G.trigger("jsp-scroll-x",[-s,aQ,aP])}function w(aN,s){if(aB.showArrows){at[aN?"addClass":"removeClass"]("jspDisabled");ah[s?"addClass":"removeClass"]("jspDisabled")}}function u(aN,s){if(aB.showArrows){aA[aN?"addClass":"removeClass"]("jspDisabled");A[s?"addClass":"removeClass"]("jspDisabled")}}function O(s,aN){var aO=s/(ab-x);X(aO*k,aN)}function P(aN,s){var aO=aN/(V-am);Y(aO*l,s)}function ad(aZ,aU,aO){var aS,aP,aQ,s=0,aY=0,aN,aT,aW,aV,aX;try{aS=b(aZ)}catch(aR){return}aP=aS.outerHeight();aQ=aS.outerWidth();ao.scrollTop(0);ao.scrollLeft(0);while(!aS.is(".jspPane")){s+=aS.position().top;aY+=aS.position().left;aS=aS.offsetParent();if(/^body|html$/i.test(aS[0].nodeName)){return}}aN=aD();aT=aN+x;if(s<aN||aU){aV=s-aB.verticalGutter}else{if(s+aP>aT){aV=s-x+aP+aB.verticalGutter}}if(aV){O(aV,aO)}viewportLeft=aF();aW=viewportLeft+am;if(aY<viewportLeft||aU){aX=aY-aB.horizontalGutter}else{if(aY+aQ>aW){aX=aY-am+aQ+aB.horizontalGutter}}if(aX){P(aX,aO)}}function aF(){return -aa.position().left}function aD(){return -aa.position().top}function ai(){ao.unbind(ae).bind(ae,function(aQ,aR,aP,aN){var aO=ac,s=L;S.scrollBy(aP*aB.mouseWheelSpeed,-aN*aB.mouseWheelSpeed,false);return aO==ac&&s==L})}function p(){ao.unbind(ae)}function aE(){return false}function M(){aa.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(s){ad(s.target,false)})}function H(){aa.find(":input,a").unbind("focus.jsp")}function z(){var aN=ac,s=L;switch(E){case 40:S.scrollByY(aB.keyboardSpeed,false);break;case 38:S.scrollByY(-aB.keyboardSpeed,false);break;case 34:case 32:S.scrollByY(x*aB.scrollPagePercent,false);break;case 33:S.scrollByY(-x*aB.scrollPagePercent,false);break;case 39:S.scrollByX(aB.keyboardSpeed,false);break;case 37:S.scrollByX(-aB.keyboardSpeed,false);break}return aN!=ac||s!=L}function g(s){aw=setTimeout(function(){g()},s?aB.initialDelay:aB.keyboardRepeatFreq);if(!z()){aH()}}function aH(){E=null;aw&&clearTimeout(aw);aw=null}function U(){aa.focus(function(){G.focus()});G.attr("tabindex",0).unbind("keydown.jsp keyup.jsp").bind("keydown.jsp",function(aO){if(aO.target!==this){return}var aN=ac,s=L;switch(aO.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:if(E!=aO.keyCode){aH();E=aO.keyCode;g(true)}break;case 35:O(ab-x);E=null;break;case 36:O(0);E=null;break}if(E==aO.keyCode||aN!=ac||s!=L){return false}}).bind("keyup.jsp",function(s){aH()});if(aB.hideFocus){G.css("outline","none");if("hideFocus" in ao[0]){G.attr("hideFocus",true)}}else{G.css("outline","");if("hideFocus" in ao[0]){G.attr("hideFocus",false)}}}function T(){G.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keyup.jsp")}function F(){if(location.hash&&location.hash.length>1){var aO,aN;try{aO=b(location.hash)}catch(s){return}if(aO.length&&aa.find(location.hash)){if(ao.scrollTop()===0){aN=setInterval(function(){if(ao.scrollTop()>0){ad(location.hash,true);b(document).scrollTop(ao.position().top);clearInterval(aN)}},50)}else{ad(location.hash,true);b(document).scrollTop(ao.position().top)}}}}function ak(){b("a.jspHijack").unbind("click.jsp-hijack").removeClass("jspHijack")}function o(){ak();b("a[href^=#]").addClass("jspHijack").bind("click.jsp-hijack",function(){var s=this.href.split("#"),aN;if(s.length>1){aN=s[1];if(aN.length>0&&aa.find("#"+aN).length>0){ad("#"+aN,true);return false}}})}function aK(){if(!b(":focus").length){G.focus()}}function aq(){var aO,aN,aQ,aP,aR,s=false;ao.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(aS){var aT=aS.originalEvent.touches[0];aO=aF();aN=aD();aQ=aT.pageX;aP=aT.pageY;aR=false;s=true}).bind("touchmove.jsp",function(aV){if(!s){return}var aU=aV.originalEvent.touches[0],aT=ac,aS=L;S.scrollTo(aO+aQ-aU.pageX,aN+aP-aU.pageY);aR=aR||Math.abs(aQ-aU.pageX)>5||Math.abs(aP-aU.pageY)>5;return aT==ac&&aS==L}).bind("touchend.jsp",function(aS){s=false}).bind("click.jsp-touchclick",function(aS){if(aR){aR=false;
return false}})}function i(){if(aI){ap.remove()}if(aC){W.remove()}aa.children().unwrap().unwrap();G.removeClass("jspScrollable").removeAttr("style").removeAttr("tabindex").removeData("jsp");G.unbind(".jsp")}b.extend(S,{reinitialise:function(aN){aN=b.extend({},aB,aN);au(aN)},scrollToElement:function(aO,aN,s){ad(aO,aN,s)},scrollTo:function(aO,s,aN){P(aO,aN);O(s,aN)},scrollToX:function(aN,s){P(aN,s)},scrollToY:function(s,aN){O(s,aN)},scrollBy:function(aN,s,aO){S.scrollByX(aN,aO);S.scrollByY(s,aO)},scrollByX:function(s,aO){var aN=aF()+s,aP=aN/(V-am);Y(aP*l,aO)},scrollByY:function(s,aO){var aN=aD()+s,aP=aN/(ab-x);X(aP*k,aO)},animate:function(aN,aQ,s,aP){var aO={};aO[aQ]=s;aN.animate(aO,{duration:aB.animateDuration,ease:aB.animateEase,queue:false,step:aP})},getContentPositionX:function(){return aF()},getContentPositionY:function(){return aD()},getIsScrollableH:function(){return aI},getIsScrollableV:function(){return aC},getContentPane:function(){return aa},scrollToBottom:function(s){X(k,s)},hijackInternalLinks:function(){o()},destroy:function(){i()}});au(Q)}f=b.extend({},b.fn.jScrollPane.defaults,f);b.each(["mouseWheelSpeed","arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){f[this]=f[this]||f.speed});var e;this.each(function(){var g=b(this),h=g.data("jsp");if(h){h.reinitialise(f)}else{h=new d(g,f);g.data("jsp",h)}e=e?e.add(g):g});return e};b.fn.jScrollPane.defaults={showArrows:false,maintainPosition:true,clickOnTrack:true,autoReinitialise:false,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,animateScroll:false,animateDuration:300,animateEase:"linear",hijackInternalLinks:false,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:0,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:false,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:true,hideFocus:false,keyboardSpeed:0,keyboardRepeatFreq:50,initialDelay:300,speed:30,scrollPagePercent:0.8}})(jQuery,this);